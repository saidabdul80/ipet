import{r as i,ac as ae,o as oe,g as S,f as C,w as e,h as l,q as c,V as d,s as g,W as N,i as s,n as p,p as o,G as O,v as _,t as u,m as U,a4 as j,ad as G,P as $,aa as B,j as H,I as W,M as w,Z as D,_ as A,H as se,e as E,k as ue,af as ne,a9 as J,T as K,J as de,K as ie,x as re,a2 as P}from"./app-BU2Ar5cD.js";const me={class:"text-h4"},fe={class:"text-h4"},ve={class:"text-h4"},_e={class:"text-h4"},ge={class:"font-weight-bold"},pe={class:"text-caption"},ye={class:"font-weight-bold"},ce={class:"text-caption"},be={key:0,class:"text-caption text-error"},Ve={class:"mb-4"},ke={class:"text-caption"},xe={class:"text-h6"},De={__name:"DebtorsList",setup(Ce){const F=i(!1),L=i(!1),M=i([]),b=i({}),q=i({}),T=i(!1),V=i(!1),I=i(!1),v=i(null),k=i(null),{alert:Z}=ae(),y=i({search:"",category:null}),r=i({amount:0,payment_method:"",reference:"",notes:""}),Q=["general","retailer","wholesaler"],X=[{title:"Cash",value:"cash"},{title:"Card",value:"card"},{title:"Bank Transfer",value:"bank_transfer"},{title:"Wallet",value:"wallet"}],Y=[{title:"Customer",key:"customer.name"},{title:"Total Outstanding",key:"total_outstanding"},{title:"Total Overdue",key:"total_overdue"},{title:"Credit Limit",key:"credit_limit"},{title:"Credit Available",key:"credit_available"},{title:"Invoices",key:"outstanding_invoices_count"},{title:"Oldest Invoice",key:"oldest_invoice_date"},{title:"Actions",key:"actions",sortable:!1}],h=[{title:"Invoice",key:"invoice_number"},{title:"Total Amount",key:"total_amount"},{title:"Paid",key:"amount_paid"},{title:"Outstanding",key:"outstanding_amount"},{title:"Due Date",key:"due_date"},{title:"Actions",key:"actions",sortable:!1}],x=async()=>{F.value=!0;try{const[n,t]=await Promise.all([P.get("/api/debtors",{params:y.value}),P.get("/api/debtors/summary",{params:y.value})]);M.value=n.data.data||[],b.value=t.data||{},q.value=t.data.aging_summary||{}}catch(n){console.error("Failed to load debtors:",n)}finally{F.value=!1}},z=async n=>{try{const t=await P.get(`/api/debtors/${n.id}`);v.value=t.data,T.value=!0}catch(t){console.error("Failed to load debtor details:",t)}},ee=n=>{k.value=n,r.value={amount:n.outstanding_amount,payment_method:"",reference:"",notes:""},V.value=!0},le=async()=>{var n,t;L.value=!0;try{await P.post(`/api/debtors/sales/${k.value.id}/payment`,r.value),V.value=!1,await z(v.value.customer),await x()}catch(a){console.error("Failed to record payment:",a),Z(((t=(n=a.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to record payment")}finally{L.value=!1}},m=n=>new Intl.NumberFormat("en-NG").format(n||0),R=n=>new Date(n).toLocaleDateString("en-NG"),te=n=>({current:"0-30 Days","31_60":"31-60 Days","61_90":"61-90 Days",over_90:"Over 90 Days"})[n]||n;return oe(()=>{x()}),(n,t)=>(C(),S(re,{fluid:""},{default:e(()=>[l(c,null,{default:e(()=>[l(d,{cols:"12"},{default:e(()=>[l(g,null,{default:e(()=>[l(N,{class:"d-flex justify-space-between align-center"},{default:e(()=>[t[15]||(t[15]=s("span",null,"Debtors Management",-1)),l(p,{color:"primary",onClick:x},{default:e(()=>[l(O,{left:""},{default:e(()=>[...t[13]||(t[13]=[o("mdi-refresh",-1)])]),_:1}),t[14]||(t[14]=o(" Refresh ",-1))]),_:1})]),_:1}),l(_,null,{default:e(()=>[l(c,null,{default:e(()=>[l(d,{cols:"12",md:"3"},{default:e(()=>[l(g,{color:"primary",dark:""},{default:e(()=>[l(_,null,{default:e(()=>[t[16]||(t[16]=s("div",{class:"text-h6"},"Total Debtors",-1)),s("div",me,u(b.value.total_debtors||0),1)]),_:1})]),_:1})]),_:1}),l(d,{cols:"12",md:"3"},{default:e(()=>[l(g,{color:"warning",dark:""},{default:e(()=>[l(_,null,{default:e(()=>[t[17]||(t[17]=s("div",{class:"text-h6"},"Total Outstanding",-1)),s("div",fe,"₦"+u(m(b.value.total_outstanding||0)),1)]),_:1})]),_:1})]),_:1}),l(d,{cols:"12",md:"3"},{default:e(()=>[l(g,{color:"error",dark:""},{default:e(()=>[l(_,null,{default:e(()=>[t[18]||(t[18]=s("div",{class:"text-h6"},"Total Overdue",-1)),s("div",ve,"₦"+u(m(b.value.total_overdue||0)),1)]),_:1})]),_:1})]),_:1}),l(d,{cols:"12",md:"3"},{default:e(()=>[l(g,{color:"info",dark:""},{default:e(()=>[l(_,null,{default:e(()=>[t[19]||(t[19]=s("div",{class:"text-h6"},"Outstanding Invoices",-1)),s("div",_e,u(b.value.total_invoices||0),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(_,null,{default:e(()=>[l(c,null,{default:e(()=>[l(d,{cols:"12",md:"4"},{default:e(()=>[l(U,{modelValue:y.value.search,"onUpdate:modelValue":t[0]||(t[0]=a=>y.value.search=a),label:"Search (Name, Code, Phone)","prepend-inner-icon":"mdi-magnify",clearable:"",onInput:x},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"4"},{default:e(()=>[l(j,{modelValue:y.value.category,"onUpdate:modelValue":[t[1]||(t[1]=a=>y.value.category=a),x],items:Q,label:"Customer Category",clearable:""},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"4"},{default:e(()=>[l(p,{color:"primary",onClick:t[2]||(t[2]=a=>I.value=!0),block:""},{default:e(()=>[l(O,{left:""},{default:e(()=>[...t[20]||(t[20]=[o("mdi-chart-bar",-1)])]),_:1}),t[21]||(t[21]=o(" View Aging Report ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),l(G,{headers:Y,items:M.value,loading:F.value,class:"elevation-1"},{"item.customer.name":e(({item:a})=>[s("div",null,[s("div",ge,u(a.customer.name),1),s("div",pe,u(a.customer.code),1)])]),"item.total_outstanding":e(({item:a})=>[l($,{color:a.total_outstanding>0?"warning":"success",size:"small"},{default:e(()=>[o(" ₦"+u(m(a.total_outstanding)),1)]),_:2},1032,["color"])]),"item.total_overdue":e(({item:a})=>[l($,{color:a.total_overdue>0?"error":"success",size:"small"},{default:e(()=>[o(" ₦"+u(m(a.total_overdue)),1)]),_:2},1032,["color"])]),"item.credit_available":e(({item:a})=>[s("span",null,"₦"+u(m(a.credit_available)),1)]),"item.oldest_invoice_date":e(({item:a})=>[o(u(a.oldest_invoice_date?R(a.oldest_invoice_date):"N/A"),1)]),"item.actions":e(({item:a})=>[l(p,{icon:"",size:"small",onClick:f=>z(a.customer)},{default:e(()=>[l(O,null,{default:e(()=>[...t[22]||(t[22]=[o("mdi-eye",-1)])]),_:1})]),_:1},8,["onClick"])]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1}),l(B,{modelValue:T.value,"onUpdate:modelValue":t[4]||(t[4]=a=>T.value=a),"max-width":"1200px"},{default:e(()=>[v.value?(C(),S(g,{key:0},{default:e(()=>[l(N,{class:"d-flex justify-space-between"},{default:e(()=>{var a;return[s("span",null,"Debtor Details: "+u((a=v.value.customer)==null?void 0:a.name),1),l(p,{icon:"",onClick:t[3]||(t[3]=f=>T.value=!1)},{default:e(()=>[l(O,null,{default:e(()=>[...t[23]||(t[23]=[o("mdi-close",-1)])]),_:1})]),_:1})]}),_:1}),l(_,null,{default:e(()=>[l(c,null,{default:e(()=>[l(d,{cols:"12",md:"6"},{default:e(()=>[l(W,null,{default:e(()=>[l(w,null,{default:e(()=>[l(D,null,{default:e(()=>[...t[24]||(t[24]=[o("Customer Code",-1)])]),_:1}),l(A,null,{default:e(()=>{var a;return[o(u((a=v.value.customer)==null?void 0:a.code),1)]}),_:1})]),_:1}),l(w,null,{default:e(()=>[l(D,null,{default:e(()=>[...t[25]||(t[25]=[o("Phone",-1)])]),_:1}),l(A,null,{default:e(()=>{var a;return[o(u(((a=v.value.customer)==null?void 0:a.phone)||"N/A"),1)]}),_:1})]),_:1})]),_:1})]),_:1}),l(d,{cols:"12",md:"6"},{default:e(()=>[l(W,null,{default:e(()=>[l(w,null,{default:e(()=>[l(D,null,{default:e(()=>[...t[26]||(t[26]=[o("Total Outstanding",-1)])]),_:1}),l(A,{class:"text-h6 text-warning"},{default:e(()=>[o("₦"+u(m(v.value.total_outstanding)),1)]),_:1})]),_:1}),l(w,null,{default:e(()=>[l(D,null,{default:e(()=>[...t[27]||(t[27]=[o("Credit Limit",-1)])]),_:1}),l(A,null,{default:e(()=>[o("₦"+u(m(v.value.credit_limit)),1)]),_:1})]),_:1}),l(w,null,{default:e(()=>[l(D,null,{default:e(()=>[...t[28]||(t[28]=[o("Credit Available",-1)])]),_:1}),l(A,{class:"text-success"},{default:e(()=>[o("₦"+u(m(v.value.credit_available)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(se,{class:"my-4"}),t[30]||(t[30]=s("h3",{class:"mb-3"},"Outstanding Invoices",-1)),l(G,{headers:h,items:v.value.sales,"items-per-page":5},{"item.invoice_number":e(({item:a})=>[s("div",null,[s("div",ye,u(a.invoice_number),1),s("div",ce,u(R(a.sale_date)),1)])]),"item.outstanding_amount":e(({item:a})=>[l($,{color:a.is_overdue?"error":"warning",size:"small"},{default:e(()=>[o(" ₦"+u(m(a.outstanding_amount)),1)]),_:2},1032,["color"])]),"item.due_date":e(({item:a})=>[s("div",null,[s("div",null,u(a.due_date?R(a.due_date):"N/A"),1),a.is_overdue?(C(),E("div",be,u(a.days_overdue)+" days overdue ",1)):H("",!0)])]),"item.actions":e(({item:a})=>[l(p,{color:"primary",size:"small",onClick:f=>ee(a)},{default:e(()=>[...t[29]||(t[29]=[o(" Record Payment ",-1)])]),_:1},8,["onClick"])]),_:1},8,["items"])]),_:1})]),_:1})):H("",!0)]),_:1},8,["modelValue"]),l(B,{modelValue:V.value,"onUpdate:modelValue":t[10]||(t[10]=a=>V.value=a),"max-width":"600px"},{default:e(()=>[l(g,null,{default:e(()=>[l(N,null,{default:e(()=>[...t[31]||(t[31]=[o("Record Payment",-1)])]),_:1}),l(_,null,{default:e(()=>[l(ue,{ref_key:"paymentForm",ref:r},{default:e(()=>[l(c,null,{default:e(()=>[l(d,{cols:"12"},{default:e(()=>{var a,f;return[s("div",Ve,[s("div",null,[t[32]||(t[32]=s("strong",null,"Invoice:",-1)),o(" "+u((a=k.value)==null?void 0:a.invoice_number),1)]),s("div",null,[t[33]||(t[33]=s("strong",null,"Outstanding:",-1)),o(" ₦"+u(m(((f=k.value)==null?void 0:f.outstanding_amount)||0)),1)])])]}),_:1}),l(d,{cols:"12"},{default:e(()=>[l(U,{modelValue:r.value.amount,"onUpdate:modelValue":t[5]||(t[5]=a=>r.value.amount=a),modelModifiers:{number:!0},label:"Payment Amount",type:"number",prefix:"₦",rules:[a=>!!a||"Amount is required",a=>a>0||"Amount must be greater than 0",a=>{var f;return a<=(((f=k.value)==null?void 0:f.outstanding_amount)||0)||"Amount cannot exceed outstanding"}],required:""},null,8,["modelValue","rules"])]),_:1}),l(d,{cols:"12"},{default:e(()=>[l(j,{modelValue:r.value.payment_method,"onUpdate:modelValue":t[6]||(t[6]=a=>r.value.payment_method=a),items:X,label:"Payment Method",rules:[a=>!!a||"Payment method is required"],required:""},null,8,["modelValue","rules"])]),_:1}),l(d,{cols:"12"},{default:e(()=>[l(U,{modelValue:r.value.reference,"onUpdate:modelValue":t[7]||(t[7]=a=>r.value.reference=a),label:"Reference (Optional)"},null,8,["modelValue"])]),_:1}),l(d,{cols:"12"},{default:e(()=>[l(ne,{modelValue:r.value.notes,"onUpdate:modelValue":t[8]||(t[8]=a=>r.value.notes=a),label:"Notes (Optional)",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),l(J,null,{default:e(()=>[l(K),l(p,{onClick:t[9]||(t[9]=a=>V.value=!1)},{default:e(()=>[...t[34]||(t[34]=[o("Cancel",-1)])]),_:1}),l(p,{color:"primary",onClick:le,loading:L.value},{default:e(()=>[...t[35]||(t[35]=[o("Submit Payment",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(B,{modelValue:I.value,"onUpdate:modelValue":t[12]||(t[12]=a=>I.value=a),"max-width":"900px"},{default:e(()=>[l(g,null,{default:e(()=>[l(N,null,{default:e(()=>[...t[36]||(t[36]=[o("Aging Report",-1)])]),_:1}),l(_,null,{default:e(()=>[l(c,null,{default:e(()=>[(C(!0),E(de,null,ie(q.value,(a,f)=>(C(),S(d,{cols:"12",md:"3",key:f},{default:e(()=>[l(g,null,{default:e(()=>[l(_,null,{default:e(()=>[s("div",ke,u(te(f)),1),s("div",xe,"₦"+u(m(a)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),l(J,null,{default:e(()=>[l(K),l(p,{onClick:t[11]||(t[11]=a=>I.value=!1)},{default:e(()=>[...t[37]||(t[37]=[o("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{De as default};
