import{ac as de,b as ne,r as d,o as me,a2 as c,e as b,f as n,h as a,w as t,V as s,i,q as T,m as p,a4 as M,g,j as $,E as W,n as v,p as r,G as w,ad as ce,P as q,t as m,s as I,W as J,v as K,k as pe,af as ve,ae as fe,a9 as O,T as Q,aa as X,H as ye,au as ge,J as Ve,K as Ce}from"./app-BU2Ar5cD.js";import{u as _e}from"./useToast-CtmKKjnB.js";import{_ as ke}from"./ProductSelect-COA5RsXy.js";import"./AddNewSelect-DGVIgTqL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const be={class:"font-weight-bold"},we={class:"text-caption text-grey"},Pe={key:1,class:"text-grey"},xe={key:1,class:"text-grey"},Ae={__name:"CustomerList",setup(Ue){const{success:P,handleError:V}=_e(),{confirm:Y}=de(),D=ne(),R=d(!1),N=d(!1),A=d(!1),C=d(!1),x=d(!1),U=d(!1),F=d(""),z=d(null),G=d([]),B=d([]),y=d(null),_=d([]),L=[{title:"Walk-in",value:"walk_in"},{title:"Registered",value:"registered"}],Z=[{title:"General",value:"general"},{title:"Retailer",value:"retailer"},{title:"Wholesaler",value:"wholesaler"}],h=[{title:"Customer",key:"name"},{title:"Phone",key:"phone"},{title:"Type",key:"type"},{title:"Category",key:"category"},{title:"Wallet Balance",key:"wallet_balance"},{title:"Status",key:"is_active"},{title:"Actions",key:"actions",sortable:!1}],u=d({name:"",email:"",phone:"",customer_type:"registered",category:"retailer",address:"",city:"",state:"",country:"",credit_limit:0,is_active:!0}),f=d({product_id:null,special_price:0}),E=o=>new Intl.NumberFormat("en-NG").format(o),ee=o=>({walk_in:"warning",registered:"primary"})[o]||"default",le=o=>({wholesaler:"success",retailer:"info"})[o]||"default",S=async()=>{R.value=!0;try{const o={search:F.value,customer_type:z.value},e=await c.get("/api/customers",{params:o});G.value=e.data.data||e.data}catch(o){console.error("Failed to load customers:",o)}finally{R.value=!1}},ae=()=>{U.value=!1,u.value={name:"",email:"",phone:"",customer_type:"registered",category:"retailer",address:"",city:"",state:"",country:"",credit_limit:0,is_active:!0},C.value=!0},te=o=>{U.value=!0,u.value={...o},C.value=!0},j=()=>{C.value=!1},oe=async()=>{N.value=!0;try{U.value?(await c.put(`/api/customers/${u.value.id}`,u.value),P("Customer updated successfully")):(await c.post("/api/customers",u.value),P("Customer created successfully")),j(),S()}catch(o){V(o,"Failed to save customer")}finally{N.value=!1}},ue=o=>{console.log("View customer:",o)},se=async o=>{y.value=o;try{const e=await c.get(`/api/customers/${o.id}/pricing`);_.value=e.data.data||e.data}catch(e){V(e,"Failed to load pricing")}x.value=!0},ie=async()=>{if(!f.value.product_id||!f.value.special_price){V({message:"Please fill all fields"},"Please fill all fields");return}A.value=!0;try{await c.post(`/api/customers/${y.value.id}/pricing`,f.value);const o=await c.get(`/api/customers/${y.value.id}/pricing`);_.value=o.data.data||o.data,f.value={product_id:null,special_price:0},P("Special pricing added successfully")}catch(o){V(o,"Failed to add pricing")}finally{A.value=!1}},re=async o=>{if(await Y("Remove this special pricing?"))try{await c.delete(`/api/customers/${y.value.id}/pricing/${o.id}`);const l=await c.get(`/api/customers/${y.value.id}/pricing`);_.value=l.data.data||l.data,P("Special pricing removed successfully")}catch(l){V(l,"Failed to remove pricing")}};return me(async()=>{const o=await c.get("/api/products");B.value=o.data.data||o.data,S()}),(o,e)=>(n(),b("div",null,[a(T,null,{default:t(()=>[a(s,{cols:"12"},{default:t(()=>[...e[19]||(e[19]=[i("h1",{class:"text-h4 mb-4"},"Customers",-1)])]),_:1})]),_:1}),a(T,null,{default:t(()=>[a(s,{cols:"12",md:"6"},{default:t(()=>[a(p,{modelValue:F.value,"onUpdate:modelValue":e[0]||(e[0]=l=>F.value=l),label:"Search customers...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:S},null,8,["modelValue"])]),_:1}),a(s,{cols:"12",md:"3"},{default:t(()=>[a(M,{modelValue:z.value,"onUpdate:modelValue":[e[1]||(e[1]=l=>z.value=l),S],items:L,label:"Customer Type",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),a(s,{cols:"12",md:"3",class:"text-right"},{default:t(()=>[W(D).hasPermission("create_customers")?(n(),g(v,{key:0,color:"primary",onClick:ae},{default:t(()=>[a(w,{left:""},{default:t(()=>[...e[20]||(e[20]=[r("mdi-plus",-1)])]),_:1}),e[21]||(e[21]=r(" Add Customer ",-1))]),_:1})):$("",!0)]),_:1})]),_:1}),a(I,null,{default:t(()=>[a(ce,{headers:h,items:G.value,loading:R.value},{"item.name":t(({item:l})=>[i("div",null,[i("div",be,m(l.name),1),i("div",we,m(l.email),1)])]),"item.type":t(({item:l})=>[a(q,{color:ee(l.type),size:"small"},{default:t(()=>[r(m(l.type==="walk_in"?"Walk-in":"Registered"),1)]),_:2},1032,["color"])]),"item.category":t(({item:l})=>[l.category?(n(),g(q,{key:0,color:le(l.category),size:"small"},{default:t(()=>[r(m(l.category==="wholesaler"?"Wholesaler":"Retailer"),1)]),_:2},1032,["color"])):(n(),b("span",Pe,"-"))]),"item.wallet_balance":t(({item:l})=>[r(" ₦"+m(E(l.wallet_balance||0)),1)]),"item.is_active":t(({item:l})=>[a(q,{color:l.is_active?"success":"error",size:"small"},{default:t(()=>[r(m(l.is_active?"Active":"Inactive"),1)]),_:2},1032,["color"])]),"item.actions":t(({item:l})=>[a(v,{icon:"",size:"small",onClick:k=>ue(l),title:"View"},{default:t(()=>[a(w,null,{default:t(()=>[...e[22]||(e[22]=[r("mdi-eye",-1)])]),_:1})]),_:1},8,["onClick"]),W(D).hasPermission("update_customers")?(n(),g(v,{key:0,icon:"",size:"small",onClick:k=>te(l),title:"Edit"},{default:t(()=>[a(w,null,{default:t(()=>[...e[23]||(e[23]=[r("mdi-pencil",-1)])]),_:1})]),_:1},8,["onClick"])):$("",!0),W(D).hasPermission("manage_customer_pricing")?(n(),g(v,{key:1,icon:"",size:"small",onClick:k=>se(l),title:"Manage Pricing",color:"info"},{default:t(()=>[a(w,null,{default:t(()=>[...e[24]||(e[24]=[r("mdi-currency-usd",-1)])]),_:1})]),_:1},8,["onClick"])):$("",!0)]),_:1},8,["items","loading"])]),_:1}),a(X,{modelValue:C.value,"onUpdate:modelValue":e[13]||(e[13]=l=>C.value=l),"max-width":"700px",persistent:""},{default:t(()=>[a(I,null,{default:t(()=>[a(J,null,{default:t(()=>[r(m(U.value?"Edit Customer":"New Customer"),1)]),_:1}),a(K,null,{default:t(()=>[a(pe,{ref:"form"},{default:t(()=>[a(T,null,{default:t(()=>[a(s,{cols:"12",md:"6"},{default:t(()=>[a(p,{modelValue:u.value.name,"onUpdate:modelValue":e[2]||(e[2]=l=>u.value.name=l),label:"Name *",variant:"outlined",rules:[l=>!!l||"Required"]},null,8,["modelValue","rules"])]),_:1}),a(s,{cols:"12",md:"6"},{default:t(()=>[a(p,{modelValue:u.value.email,"onUpdate:modelValue":e[3]||(e[3]=l=>u.value.email=l),label:"Email *",type:"email",variant:"outlined",rules:[l=>!!l||"Required"]},null,8,["modelValue","rules"])]),_:1}),a(s,{cols:"12",md:"6"},{default:t(()=>[a(p,{modelValue:u.value.phone,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.phone=l),label:"Phone *",variant:"outlined",rules:[l=>!!l||"Required"]},null,8,["modelValue","rules"])]),_:1}),a(s,{cols:"12",md:"6"},{default:t(()=>[a(M,{modelValue:u.value.customer_type,"onUpdate:modelValue":e[5]||(e[5]=l=>u.value.customer_type=l),items:L,label:"Customer Type *",variant:"outlined",rules:[l=>!!l||"Required"]},null,8,["modelValue","rules"])]),_:1}),a(s,{cols:"12",md:"6"},{default:t(()=>[a(M,{modelValue:u.value.category,"onUpdate:modelValue":e[6]||(e[6]=l=>u.value.category=l),items:Z,label:"Category",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(s,{cols:"12"},{default:t(()=>[a(ve,{modelValue:u.value.address,"onUpdate:modelValue":e[7]||(e[7]=l=>u.value.address=l),label:"Address",variant:"outlined",rows:"2"},null,8,["modelValue"])]),_:1}),a(s,{cols:"12",md:"4"},{default:t(()=>[a(p,{modelValue:u.value.city,"onUpdate:modelValue":e[8]||(e[8]=l=>u.value.city=l),label:"City",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(s,{cols:"12",md:"4"},{default:t(()=>[a(p,{modelValue:u.value.state,"onUpdate:modelValue":e[9]||(e[9]=l=>u.value.state=l),label:"State",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(s,{cols:"12",md:"4"},{default:t(()=>[a(p,{modelValue:u.value.country,"onUpdate:modelValue":e[10]||(e[10]=l=>u.value.country=l),label:"Country",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(s,{cols:"12",md:"6"},{default:t(()=>[a(p,{modelValue:u.value.credit_limit,"onUpdate:modelValue":e[11]||(e[11]=l=>u.value.credit_limit=l),modelModifiers:{number:!0},label:"Credit Limit",type:"number",min:"0",variant:"outlined",prefix:"₦"},null,8,["modelValue"])]),_:1}),a(s,{cols:"12",md:"6"},{default:t(()=>[a(fe,{modelValue:u.value.is_active,"onUpdate:modelValue":e[12]||(e[12]=l=>u.value.is_active=l),label:"Active",color:"primary"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(O,null,{default:t(()=>[a(Q),a(v,{onClick:j},{default:t(()=>[...e[25]||(e[25]=[r("Cancel",-1)])]),_:1}),a(v,{color:"primary",onClick:oe,loading:N.value},{default:t(()=>[...e[26]||(e[26]=[r("Save",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(X,{modelValue:x.value,"onUpdate:modelValue":e[18]||(e[18]=l=>x.value=l),"max-width":"800px",persistent:""},{default:t(()=>[y.value?(n(),g(I,{key:0},{default:t(()=>[a(J,null,{default:t(()=>[r("Manage Pricing - "+m(y.value.name),1)]),_:1}),a(K,null,{default:t(()=>[a(T,{class:"mb-4"},{default:t(()=>[a(s,{cols:"12",md:"6"},{default:t(()=>[a(ke,{modelValue:f.value.product_id,"onUpdate:modelValue":e[14]||(e[14]=l=>f.value.product_id=l),items:B.value,"item-title":"name","item-value":"id",label:"Product *",variant:"outlined",onCreated:e[15]||(e[15]=l=>B.value.push(l))},null,8,["modelValue","items"])]),_:1}),a(s,{cols:"12",md:"4"},{default:t(()=>[a(p,{modelValue:f.value.special_price,"onUpdate:modelValue":e[16]||(e[16]=l=>f.value.special_price=l),modelModifiers:{number:!0},label:"Special Price *",type:"number",min:"0",variant:"outlined",prefix:"₦"},null,8,["modelValue"])]),_:1}),a(s,{cols:"12",md:"2"},{default:t(()=>[a(v,{color:"primary",onClick:ie,loading:A.value},{default:t(()=>[...e[27]||(e[27]=[r(" Add ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),a(ye,{class:"my-4"}),e[30]||(e[30]=i("h3",{class:"mb-2"},"Current Special Pricing",-1)),_.value.length>0?(n(),g(ge,{key:0},{default:t(()=>[e[29]||(e[29]=i("thead",null,[i("tr",null,[i("th",null,"Product"),i("th",null,"Special Price"),i("th",null,"Default Price"),i("th",null,"Actions")])],-1)),i("tbody",null,[(n(!0),b(Ve,null,Ce(_.value,l=>{var k,H;return n(),b("tr",{key:l.id},[i("td",null,m((k=l.product)==null?void 0:k.name),1),i("td",null,"₦"+m(E(l.special_price)),1),i("td",null,"₦"+m(E((H=l.product)==null?void 0:H.selling_price)),1),i("td",null,[a(v,{icon:"",size:"small",color:"error",onClick:Se=>re(l)},{default:t(()=>[a(w,null,{default:t(()=>[...e[28]||(e[28]=[r("mdi-delete",-1)])]),_:1})]),_:1},8,["onClick"])])])}),128))])]),_:1})):(n(),b("p",xe,"No special pricing configured"))]),_:1}),a(O,null,{default:t(()=>[a(Q),a(v,{onClick:e[17]||(e[17]=l=>x.value=!1)},{default:t(()=>[...e[31]||(e[31]=[r("Close",-1)])]),_:1})]),_:1})]),_:1})):$("",!0)]),_:1},8,["modelValue"])]))}};export{Ae as default};
