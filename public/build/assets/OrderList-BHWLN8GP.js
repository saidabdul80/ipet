import{b as ee,ac as le,r as m,o as te,a2 as C,e as N,f,h as t,w as a,V as n,i as s,q as D,m as L,a4 as E,g as k,j as g,E as $,n as c,p as u,G as S,ad as ae,P as G,t as d,s as U,W as H,v as J,H as F,au as se,J as oe,K as re,a9 as K,T as M,aa as Q,k as ue,af as de}from"./app-BU2Ar5cD.js";import{_ as W}from"./StoreSelect-yXqrxzRM.js";import{_ as ne}from"./DatePickerField-DWptZlfj.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useToast-CtmKKjnB.js";import"./AddNewSelect-DGVIgTqL.js";const me=["onClick"],fe={class:"d-flex justify-space-between mb-2"},ve={class:"d-flex justify-space-between mb-2"},ce={class:"d-flex justify-space-between mb-2"},pe={class:"d-flex justify-space-between text-h6"},ye={class:"text-primary"},Ve={key:0},_e={__name:"OrderList",setup(Ce){const x=ee(),{alert:b,confirm:A}=le(),P=m(!1),T=m(!1),p=m(!1),w=m(!1),j=m([]),O=m([]),B=m([]),r=m(null),y=m({search:"",status:null,store_id:null}),i=m({customer_id:null,store_id:null,delivery_date:"",delivery_address:"",notes:""}),X=[{title:"Pending",value:"pending"},{title:"Confirmed",value:"confirmed"},{title:"Processing",value:"processing"},{title:"Completed",value:"completed"},{title:"Cancelled",value:"cancelled"}],Y=[{title:"Order #",key:"order_number"},{title:"Date",key:"order_date"},{title:"Customer",key:"customer"},{title:"Total",key:"total_amount"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],V=o=>new Intl.NumberFormat("en-NG").format(o),I=o=>({pending:"warning",confirmed:"info",processing:"primary",completed:"success",cancelled:"error"})[o]||"default",_=async()=>{P.value=!0;try{const o=await C.get("/api/orders",{params:y.value});j.value=o.data.data||o.data}catch(o){console.error("Failed to load orders:",o)}finally{P.value=!1}},R=async o=>{try{const e=await C.get(`/api/orders/${o.id}`);r.value=e.data,p.value=!0}catch(e){console.error("Failed to load order details:",e)}},Z=()=>{i.value={customer_id:null,store_id:null,delivery_date:"",delivery_address:"",notes:""},w.value=!0},h=async()=>{T.value=!0;try{await C.post("/api/orders",i.value),w.value=!1,_(),b("Order created successfully")}catch(o){console.error("Failed to create order:",o),b("Failed to create order")}finally{T.value=!1}},q=async o=>{if(await A(`Confirm order ${o.order_number}?`))try{await C.post(`/api/orders/${o.id}/confirm`),_(),p.value&&(p.value=!1),b("Order confirmed successfully")}catch(l){console.error("Failed to confirm order:",l),b("Failed to confirm order")}},z=async o=>{if(await A(`Cancel order ${o.order_number}?`))try{await C.post(`/api/orders/${o.id}/cancel`),_(),p.value&&(p.value=!1),b("Order cancelled successfully")}catch(l){console.error("Failed to cancel order:",l),b("Failed to cancel order")}};return te(async()=>{const[o,e]=await Promise.all([C.get("/api/stores"),C.get("/api/customers")]);O.value=o.data.data||o.data,B.value=e.data.data||e.data,_()}),(o,e)=>(f(),N("div",null,[t(D,null,{default:a(()=>[t(n,{cols:"12"},{default:a(()=>[...e[16]||(e[16]=[s("h1",{class:"text-h4 mb-4"},"Orders",-1)])]),_:1})]),_:1}),t(D,null,{default:a(()=>[t(n,{cols:"12",md:"4"},{default:a(()=>[t(L,{modelValue:y.value.search,"onUpdate:modelValue":e[0]||(e[0]=l=>y.value.search=l),label:"Search (Order #, Customer)","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:_},null,8,["modelValue"])]),_:1}),t(n,{cols:"12",md:"3"},{default:a(()=>[t(E,{modelValue:y.value.status,"onUpdate:modelValue":[e[1]||(e[1]=l=>y.value.status=l),_],items:X,label:"Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),t(n,{cols:"12",md:"2"},{default:a(()=>[t(W,{modelValue:y.value.store_id,"onUpdate:modelValue":[e[2]||(e[2]=l=>y.value.store_id=l),_],items:O.value,"item-title":"name","item-value":"id",label:"Store",variant:"outlined",density:"compact",clearable:"",onCreated:e[3]||(e[3]=l=>O.value.push(l))},null,8,["modelValue","items"])]),_:1}),t(n,{cols:"12",md:"3",class:"text-right"},{default:a(()=>[$(x).hasPermission("create_orders")?(f(),k(c,{key:0,color:"primary",onClick:Z},{default:a(()=>[t(S,{left:""},{default:a(()=>[...e[17]||(e[17]=[u("mdi-plus",-1)])]),_:1}),e[18]||(e[18]=u(" New Order ",-1))]),_:1})):g("",!0)]),_:1})]),_:1}),t(U,null,{default:a(()=>[t(ae,{headers:Y,items:j.value,loading:P.value},{"item.order_number":a(({item:l})=>[s("a",{onClick:v=>R(l),class:"text-primary cursor-pointer"},d(l.order_number),9,me)]),"item.customer":a(({item:l})=>{var v;return[u(d((v=l.customer)==null?void 0:v.name),1)]}),"item.total_amount":a(({item:l})=>[u(" ₦"+d(V(l.total_amount)),1)]),"item.status":a(({item:l})=>[t(G,{color:I(l.status),size:"small"},{default:a(()=>[u(d(l.status),1)]),_:2},1032,["color"])]),"item.actions":a(({item:l})=>[t(c,{icon:"",size:"small",onClick:v=>R(l),title:"View"},{default:a(()=>[t(S,null,{default:a(()=>[...e[19]||(e[19]=[u("mdi-eye",-1)])]),_:1})]),_:1},8,["onClick"]),l.status==="pending"&&$(x).hasPermission("confirm_orders")?(f(),k(c,{key:0,icon:"",size:"small",onClick:v=>q(l),title:"Confirm",color:"success"},{default:a(()=>[t(S,null,{default:a(()=>[...e[20]||(e[20]=[u("mdi-check",-1)])]),_:1})]),_:1},8,["onClick"])):g("",!0),l.status!=="cancelled"&&$(x).hasPermission("cancel_orders")?(f(),k(c,{key:1,icon:"",size:"small",onClick:v=>z(l),title:"Cancel",color:"error"},{default:a(()=>[t(S,null,{default:a(()=>[...e[21]||(e[21]=[u("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])):g("",!0)]),_:1},8,["items","loading"])]),_:1}),t(Q,{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=l=>p.value=l),"max-width":"900px"},{default:a(()=>[r.value?(f(),k(U,{key:0},{default:a(()=>[t(H,{class:"bg-primary text-white"},{default:a(()=>[u(" Order Details - "+d(r.value.order_number)+" ",1),t(G,{color:I(r.value.status),class:"ml-2"},{default:a(()=>[u(d(r.value.status),1)]),_:1},8,["color"])]),_:1}),t(J,{class:"mt-4"},{default:a(()=>[t(D,null,{default:a(()=>[t(n,{cols:"6"},{default:a(()=>[e[22]||(e[22]=s("strong",null,"Date:",-1)),u(" "+d(r.value.order_date),1)]),_:1}),t(n,{cols:"6"},{default:a(()=>{var l;return[e[23]||(e[23]=s("strong",null,"Customer:",-1)),u(" "+d((l=r.value.customer)==null?void 0:l.name),1)]}),_:1}),t(n,{cols:"6"},{default:a(()=>{var l;return[e[24]||(e[24]=s("strong",null,"Store:",-1)),u(" "+d((l=r.value.store)==null?void 0:l.name),1)]}),_:1}),t(n,{cols:"6"},{default:a(()=>[e[25]||(e[25]=s("strong",null,"Delivery Date:",-1)),u(" "+d(r.value.delivery_date||"N/A"),1)]),_:1}),t(n,{cols:"12"},{default:a(()=>[e[26]||(e[26]=s("strong",null,"Delivery Address:",-1)),u(" "+d(r.value.delivery_address||"N/A"),1)]),_:1})]),_:1}),t(F,{class:"my-4"}),e[33]||(e[33]=s("h3",{class:"mb-2"},"Items",-1)),t(se,null,{default:a(()=>[e[27]||(e[27]=s("thead",null,[s("tr",null,[s("th",null,"Product"),s("th",null,"Quantity"),s("th",null,"Unit Price"),s("th",null,"Subtotal")])],-1)),s("tbody",null,[(f(!0),N(oe,null,re(r.value.items,l=>{var v;return f(),N("tr",{key:l.id},[s("td",null,d((v=l.product)==null?void 0:v.name),1),s("td",null,d(l.quantity),1),s("td",null,"₦"+d(V(l.unit_price)),1),s("td",null,"₦"+d(V(l.subtotal)),1)])}),128))])]),_:1}),t(F,{class:"my-4"}),t(D,null,{default:a(()=>[t(n,{cols:"6",offset:"6"},{default:a(()=>[s("div",fe,[e[28]||(e[28]=s("span",null,"Subtotal:",-1)),s("span",null,"₦"+d(V(r.value.subtotal_amount)),1)]),s("div",ve,[e[29]||(e[29]=s("span",null,"Discount:",-1)),s("span",null,"₦"+d(V(r.value.discount_amount)),1)]),s("div",ce,[e[30]||(e[30]=s("span",null,"Tax:",-1)),s("span",null,"₦"+d(V(r.value.tax_amount)),1)]),t(F,{class:"my-2"}),s("div",pe,[e[31]||(e[31]=s("span",null,"Total:",-1)),s("span",ye,"₦"+d(V(r.value.total_amount)),1)])]),_:1})]),_:1}),t(F,{class:"my-4"}),r.value.notes?(f(),N("div",Ve,[e[32]||(e[32]=s("strong",null,"Notes:",-1)),s("p",null,d(r.value.notes),1)])):g("",!0)]),_:1}),t(K,null,{default:a(()=>[r.value.status==="pending"&&$(x).hasPermission("confirm_orders")?(f(),k(c,{key:0,color:"success",onClick:e[4]||(e[4]=l=>q(r.value))},{default:a(()=>[...e[34]||(e[34]=[u(" Confirm Order ",-1)])]),_:1})):g("",!0),r.value.status!=="cancelled"&&$(x).hasPermission("cancel_orders")?(f(),k(c,{key:1,color:"error",onClick:e[5]||(e[5]=l=>z(r.value))},{default:a(()=>[...e[35]||(e[35]=[u(" Cancel Order ",-1)])]),_:1})):g("",!0),t(M),t(c,{onClick:e[6]||(e[6]=l=>p.value=!1)},{default:a(()=>[...e[36]||(e[36]=[u("Close",-1)])]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1},8,["modelValue"]),t(Q,{modelValue:w.value,"onUpdate:modelValue":e[15]||(e[15]=l=>w.value=l),"max-width":"800px",persistent:""},{default:a(()=>[t(U,null,{default:a(()=>[t(H,null,{default:a(()=>[...e[37]||(e[37]=[u("New Order",-1)])]),_:1}),t(J,null,{default:a(()=>[t(ue,{ref:"orderForm"},{default:a(()=>[t(D,null,{default:a(()=>[t(n,{cols:"12",md:"6"},{default:a(()=>[t(E,{modelValue:i.value.customer_id,"onUpdate:modelValue":e[8]||(e[8]=l=>i.value.customer_id=l),items:B.value,"item-title":"name","item-value":"id",label:"Customer *",variant:"outlined",rules:[l=>!!l||"Required"]},null,8,["modelValue","items","rules"])]),_:1}),t(n,{cols:"12",md:"6"},{default:a(()=>[t(W,{modelValue:i.value.store_id,"onUpdate:modelValue":e[9]||(e[9]=l=>i.value.store_id=l),items:O.value,"item-title":"name","item-value":"id",label:"Store *",variant:"outlined",rules:[l=>!!l||"Required"],onCreated:e[10]||(e[10]=l=>O.value.push(l))},null,8,["modelValue","items","rules"])]),_:1}),t(n,{cols:"12",md:"6"},{default:a(()=>[t(ne,{modelValue:i.value.delivery_date,"onUpdate:modelValue":e[11]||(e[11]=l=>i.value.delivery_date=l),label:"Delivery Date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(n,{cols:"12",md:"6"},{default:a(()=>[t(L,{modelValue:i.value.delivery_address,"onUpdate:modelValue":e[12]||(e[12]=l=>i.value.delivery_address=l),label:"Delivery Address",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(n,{cols:"12"},{default:a(()=>[t(de,{modelValue:i.value.notes,"onUpdate:modelValue":e[13]||(e[13]=l=>i.value.notes=l),label:"Notes",variant:"outlined",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1}),e[38]||(e[38]=s("p",{class:"text-caption text-grey"},"Note: Add items after creating the order",-1))]),_:1},512)]),_:1}),t(K,null,{default:a(()=>[t(M),t(c,{onClick:e[14]||(e[14]=l=>w.value=!1)},{default:a(()=>[...e[39]||(e[39]=[u("Cancel",-1)])]),_:1}),t(c,{color:"primary",onClick:h,loading:T.value},{default:a(()=>[...e[40]||(e[40]=[u("Create Order",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},De=ie(_e,[["__scopeId","data-v-16643127"]]);export{De as default};
