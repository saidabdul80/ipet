import{b as E,ac as H,r as v,o as J,e as p,f as i,h as t,j as y,w as a,V as r,i as l,q as c,m as K,a4 as L,J as S,K as T,g as x,s as A,W as F,t as n,P as j,p as d,v as B,a9 as P,n as C,G as $,T as I,H as k,au as Q,aa as R,a2 as D}from"./app-CJq9zEpr.js";const W={class:"text-h6 text-primary"},X={key:0,class:"text-center text-grey py-8"},Y={class:"d-flex justify-space-between mb-2"},Z={class:"d-flex justify-space-between mb-2"},h={class:"d-flex justify-space-between mb-2"},ee={class:"d-flex justify-space-between text-h6"},le={class:"text-primary"},se={__name:"MyOrders",setup(te){const U=E(),{alert:O,confirm:M}=H(),_=v(!1),g=v(!1),w=v([]),u=v(null),m=v({search:"",status:null}),q=[{title:"Pending",value:"pending"},{title:"Confirmed",value:"confirmed"},{title:"Processing",value:"processing"},{title:"Completed",value:"completed"},{title:"Cancelled",value:"cancelled"}],f=o=>new Intl.NumberFormat("en-NG").format(o),N=o=>({pending:"warning",confirmed:"info",processing:"primary",completed:"success",cancelled:"error"})[o]||"default",V=async()=>{_.value=!0;try{const o={...m.value,customer_id:U.user.id},e=await D.get("/api/orders",{params:o});w.value=e.data.data||e.data}catch(o){console.error("Failed to load orders:",o)}finally{_.value=!1}},z=async o=>{try{const e=await D.get(`/api/orders/${o.id}`);u.value=e.data,g.value=!0}catch(e){console.error("Failed to load order details:",e)}},G=async o=>{if(await M("Are you sure you want to cancel this order?"))try{await D.post(`/api/orders/${o.id}/cancel`),V(),O("Order cancelled successfully")}catch(s){console.error("Failed to cancel order:",s),O("Failed to cancel order")}};return J(()=>{V()}),(o,e)=>(i(),p("div",null,[t(c,null,{default:a(()=>[t(r,{cols:"12"},{default:a(()=>[...e[4]||(e[4]=[l("h1",{class:"text-h4 mb-4"},"My Orders",-1)])]),_:1})]),_:1}),t(c,null,{default:a(()=>[t(r,{cols:"12",md:"4"},{default:a(()=>[t(K,{modelValue:m.value.search,"onUpdate:modelValue":e[0]||(e[0]=s=>m.value.search=s),label:"Search orders...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:V},null,8,["modelValue"])]),_:1}),t(r,{cols:"12",md:"4"},{default:a(()=>[t(L,{modelValue:m.value.status,"onUpdate:modelValue":[e[1]||(e[1]=s=>m.value.status=s),V],items:q,label:"Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(c,null,{default:a(()=>[(i(!0),p(S,null,T(w.value,s=>(i(),x(r,{key:s.id,cols:"12",md:"6"},{default:a(()=>[t(A,null,{default:a(()=>[t(F,{class:"d-flex justify-space-between align-center"},{default:a(()=>[l("span",null,"Order #"+n(s.order_number),1),t(j,{color:N(s.status),size:"small"},{default:a(()=>[d(n(s.status),1)]),_:2},1032,["color"])]),_:2},1024),t(B,null,{default:a(()=>[t(c,null,{default:a(()=>[t(r,{cols:"6"},{default:a(()=>[e[5]||(e[5]=l("div",{class:"text-caption text-grey"},"Order Date",-1)),l("div",null,n(s.order_date),1)]),_:2},1024),t(r,{cols:"6"},{default:a(()=>[e[6]||(e[6]=l("div",{class:"text-caption text-grey"},"Total Amount",-1)),l("div",W,"₦"+n(f(s.total_amount)),1)]),_:2},1024),s.delivery_date?(i(),x(r,{key:0,cols:"12"},{default:a(()=>[e[7]||(e[7]=l("div",{class:"text-caption text-grey"},"Delivery Date",-1)),l("div",null,n(s.delivery_date),1)]),_:2},1024)):y("",!0),s.delivery_address?(i(),x(r,{key:1,cols:"12"},{default:a(()=>[e[8]||(e[8]=l("div",{class:"text-caption text-grey"},"Delivery Address",-1)),l("div",null,n(s.delivery_address),1)]),_:2},1024)):y("",!0)]),_:2},1024)]),_:2},1024),t(P,null,{default:a(()=>[t(C,{onClick:b=>z(s)},{default:a(()=>[t($,{left:""},{default:a(()=>[...e[9]||(e[9]=[d("mdi-eye",-1)])]),_:1}),e[10]||(e[10]=d(" View Details ",-1))]),_:1},8,["onClick"]),t(I),s.status==="pending"?(i(),x(C,{key:0,color:"error",variant:"text",onClick:b=>G(s)},{default:a(()=>[...e[11]||(e[11]=[d(" Cancel ",-1)])]),_:1},8,["onClick"])):y("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),w.value.length===0&&!_.value?(i(),p("div",X,[t($,{size:"64"},{default:a(()=>[...e[12]||(e[12]=[d("mdi-package-variant-closed",-1)])]),_:1}),e[13]||(e[13]=l("div",{class:"mt-2"},"No orders found",-1))])):y("",!0),t(R,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=s=>g.value=s),"max-width":"700px"},{default:a(()=>[u.value?(i(),x(A,{key:0},{default:a(()=>[t(F,{class:"bg-primary text-white"},{default:a(()=>[d(" Order #"+n(u.value.order_number)+" ",1),t(j,{color:N(u.value.status),class:"ml-2"},{default:a(()=>[d(n(u.value.status),1)]),_:1},8,["color"])]),_:1}),t(B,{class:"mt-4"},{default:a(()=>[t(c,null,{default:a(()=>[t(r,{cols:"6"},{default:a(()=>[e[14]||(e[14]=l("strong",null,"Order Date:",-1)),d(" "+n(u.value.order_date),1)]),_:1}),t(r,{cols:"6"},{default:a(()=>[e[15]||(e[15]=l("strong",null,"Delivery Date:",-1)),d(" "+n(u.value.delivery_date||"N/A"),1)]),_:1}),t(r,{cols:"12"},{default:a(()=>[e[16]||(e[16]=l("strong",null,"Delivery Address:",-1)),d(" "+n(u.value.delivery_address||"N/A"),1)]),_:1})]),_:1}),t(k,{class:"my-4"}),e[22]||(e[22]=l("h3",{class:"mb-2"},"Order Items",-1)),t(Q,null,{default:a(()=>[e[17]||(e[17]=l("thead",null,[l("tr",null,[l("th",null,"Product"),l("th",null,"Quantity"),l("th",null,"Unit Price"),l("th",null,"Subtotal")])],-1)),l("tbody",null,[(i(!0),p(S,null,T(u.value.items,s=>{var b;return i(),p("tr",{key:s.id},[l("td",null,n((b=s.product)==null?void 0:b.name),1),l("td",null,n(s.quantity),1),l("td",null,"₦"+n(f(s.unit_price)),1),l("td",null,"₦"+n(f(s.subtotal)),1)])}),128))])]),_:1}),t(k,{class:"my-4"}),t(c,null,{default:a(()=>[t(r,{cols:"6",offset:"6"},{default:a(()=>[l("div",Y,[e[18]||(e[18]=l("span",null,"Subtotal:",-1)),l("span",null,"₦"+n(f(u.value.subtotal_amount)),1)]),l("div",Z,[e[19]||(e[19]=l("span",null,"Discount:",-1)),l("span",null,"₦"+n(f(u.value.discount_amount)),1)]),l("div",h,[e[20]||(e[20]=l("span",null,"Tax:",-1)),l("span",null,"₦"+n(f(u.value.tax_amount)),1)]),t(k,{class:"my-2"}),l("div",ee,[e[21]||(e[21]=l("span",null,"Total:",-1)),l("span",le,"₦"+n(f(u.value.total_amount)),1)])]),_:1})]),_:1})]),_:1}),t(P,null,{default:a(()=>[t(I),t(C,{onClick:e[2]||(e[2]=s=>g.value=!1)},{default:a(()=>[...e[23]||(e[23]=[d("Close",-1)])]),_:1})]),_:1})]),_:1})):y("",!0)]),_:1},8,["modelValue"])]))}};export{se as default};
