import{r as d,ac as J,c as O,o as Q,g as U,f as k,w as l,h as a,s as D,W as M,i as X,n as V,p as o,G as _,v as N,q as T,V as c,M as A,ai as B,aj as z,t as u,ad as Y,P as Z,a7 as I,aa as h,k as ee,a4 as te,m as P,j as le,ak as w,a9 as ae,T as se,x as ie,a2 as v}from"./app-BU2Ar5cD.js";import{_ as oe}from"./ProductSelect-COA5RsXy.js";import"./useToast-CtmKKjnB.js";import"./AddNewSelect-DGVIgTqL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={__name:"ProductUnits",setup(ue){const y=d([]),r=d(null),x=d([]),F=d([]),b=d(!1),p=d(!1),g=d(!1),j=d(null),i=d({unit_id:null,conversion_factor:1,selling_price:0,cost_price:0,is_purchase_unit:!0,is_sale_unit:!0,is_default:!1}),{alert:f,confirm:R}=J(),q=[{title:"Unit",key:"unit"},{title:"Conversion",key:"conversion_factor"},{title:"Selling Price",key:"selling_price"},{title:"Cost Price",key:"cost_price"},{title:"Purchase",key:"is_purchase_unit"},{title:"Sale",key:"is_sale_unit"},{title:"Default",key:"is_default"},{title:"Actions",key:"actions",sortable:!1}],$=O(()=>{var t;if(!r.value)return"units";const s=y.value.find(e=>e.id===r.value);return((t=s==null?void 0:s.unit)==null?void 0:t.short_name)||"units"}),S=s=>new Intl.NumberFormat("en-NG").format(s),G=async()=>{try{const s=await v.get("/api/products",{params:{per_page:1e3}});y.value=s.data.data||s.data}catch(s){console.error("Failed to load products:",s)}},E=async()=>{try{const s=await v.get("/api/units");F.value=s.data.data||s.data}catch(s){console.error("Failed to load units:",s)}},C=async()=>{if(r.value){b.value=!0;try{const s=await v.get(`/api/products/${r.value}/units`);x.value=s.data||[]}catch(s){console.error("Failed to load product units:",s)}finally{b.value=!1}}},H=()=>{if(!r.value){f("Please select a product first");return}g.value=!1,i.value={unit_id:null,conversion_factor:1,selling_price:0,cost_price:0,is_purchase_unit:!0,is_sale_unit:!0,is_default:!1},p.value=!0},K=s=>{var t;g.value=!0,i.value={...s,unit_id:s.unit_id||((t=s.unit)==null?void 0:t.id)||s.id},p.value=!0},L=async()=>{var s,t;try{g.value?(await v.put(`/api/products/${r.value}/units/${i.value.id}`,i.value),f("Product unit updated successfully")):(await v.post(`/api/products/${r.value}/units`,i.value),f("Product unit added successfully")),p.value=!1,C()}catch(e){console.error("Failed to save product unit:",e),f(((t=(s=e.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to save product unit")}},W=async s=>{var e,n;if(await R(`Delete unit ${s.unit.name}?`))try{await v.delete(`/api/products/${r.value}/units/${s.id}`),f("Product unit deleted successfully"),C()}catch(m){console.error("Failed to delete product unit:",m),f(((n=(e=m.response)==null?void 0:e.data)==null?void 0:n.message)||"Failed to delete product unit")}};return Q(async()=>{await Promise.all([G(),E()])}),(s,t)=>(k(),U(ie,{fluid:""},{default:l(()=>[a(D,null,{default:l(()=>[a(M,{class:"d-flex justify-space-between align-center"},{default:l(()=>[t[13]||(t[13]=X("span",null,"Product Units Management",-1)),a(V,{color:"primary",onClick:H},{default:l(()=>[a(_,{left:""},{default:l(()=>[...t[11]||(t[11]=[o("mdi-plus",-1)])]),_:1}),t[12]||(t[12]=o(" Add Product Unit ",-1))]),_:1})]),_:1}),a(N,null,{default:l(()=>[a(T,{class:"mb-4"},{default:l(()=>[a(c,{cols:"12",md:"6"},{default:l(()=>[a(oe,{modelValue:r.value,"onUpdate:modelValue":[t[0]||(t[0]=e=>r.value=e),C],items:y.value,"item-title":"name","item-value":"id",label:"Select Product",variant:"outlined",density:"compact",control:"autocomplete",onCreated:t[1]||(t[1]=e=>y.value.push(e))},{item:l(({props:e,item:n})=>[a(A,B(z(e)),{title:l(()=>[o(u(n.raw.name),1)]),subtitle:l(()=>{var m;return[o(" SKU: "+u(n.raw.sku)+" | Base Unit: "+u((m=n.raw.unit)==null?void 0:m.name),1)]}),_:2},1040)]),_:1},8,["modelValue","items"])]),_:1})]),_:1}),r.value?(k(),U(Y,{key:0,headers:q,items:x.value,loading:b.value,class:"elevation-1"},{"item.unit":l(({item:e})=>{var n,m;return[o(u((n=e.unit)==null?void 0:n.name)+" ("+u((m=e.unit)==null?void 0:m.short_name)+") ",1)]}),"item.conversion_factor":l(({item:e})=>[a(Z,{color:"info",size:"small"},{default:l(()=>{var n;return[o(" 1 "+u((n=e.unit)==null?void 0:n.short_name)+" = "+u(e.conversion_factor)+" "+u($.value),1)]}),_:2},1024)]),"item.selling_price":l(({item:e})=>[o(" ₦"+u(S(e.selling_price)),1)]),"item.cost_price":l(({item:e})=>[o(" ₦"+u(S(e.cost_price)),1)]),"item.is_purchase_unit":l(({item:e})=>[a(_,{color:e.is_purchase_unit?"success":"grey"},{default:l(()=>[o(u(e.is_purchase_unit?"mdi-check-circle":"mdi-close-circle"),1)]),_:2},1032,["color"])]),"item.is_sale_unit":l(({item:e})=>[a(_,{color:e.is_sale_unit?"success":"grey"},{default:l(()=>[o(u(e.is_sale_unit?"mdi-check-circle":"mdi-close-circle"),1)]),_:2},1032,["color"])]),"item.is_default":l(({item:e})=>[a(_,{color:e.is_default?"warning":"grey"},{default:l(()=>[o(u(e.is_default?"mdi-star":"mdi-star-outline"),1)]),_:2},1032,["color"])]),"item.actions":l(({item:e})=>[a(V,{icon:"",size:"small",color:"primary",onClick:n=>K(e)},{default:l(()=>[a(_,null,{default:l(()=>[...t[14]||(t[14]=[o("mdi-pencil",-1)])]),_:1})]),_:1},8,["onClick"]),a(V,{icon:"",size:"small",color:"error",onClick:n=>W(e)},{default:l(()=>[a(_,null,{default:l(()=>[...t[15]||(t[15]=[o("mdi-delete",-1)])]),_:1})]),_:1},8,["onClick"])]),_:1},8,["items","loading"])):(k(),U(I,{key:1,type:"info",variant:"tonal",class:"mt-4"},{default:l(()=>[...t[16]||(t[16]=[o(" Please select a product to manage its units ",-1)])]),_:1}))]),_:1})]),_:1}),a(h,{modelValue:p.value,"onUpdate:modelValue":t[10]||(t[10]=e=>p.value=e),"max-width":"600px",persistent:""},{default:l(()=>[a(D,null,{default:l(()=>[a(M,null,{default:l(()=>[o(u(g.value?"Edit":"Add")+" Product Unit ",1)]),_:1}),a(N,null,{default:l(()=>[a(ee,{ref_key:"form",ref:j},{default:l(()=>[a(T,null,{default:l(()=>[a(c,{cols:"12"},{default:l(()=>[a(te,{modelValue:i.value.unit_id,"onUpdate:modelValue":t[2]||(t[2]=e=>i.value.unit_id=e),items:F.value,"item-title":"name","item-value":"id",label:"Unit *",variant:"outlined",rules:[e=>!!e||"Required"]},{item:l(({props:e,item:n})=>[a(A,B(z(e)),{title:l(()=>[o(u(n.raw.name)+" ("+u(n.raw.short_name)+") ",1)]),_:2},1040)]),_:1},8,["modelValue","items","rules"])]),_:1}),a(c,{cols:"12",md:"6"},{default:l(()=>[a(P,{modelValue:i.value.conversion_factor,"onUpdate:modelValue":t[3]||(t[3]=e=>i.value.conversion_factor=e),modelModifiers:{number:!0},label:"Conversion Factor *",type:"number",step:"0.01",variant:"outlined",rules:[e=>e>0||"Must be > 0"],hint:"How many base units in this unit","persistent-hint":""},null,8,["modelValue","rules"])]),_:1}),a(c,{cols:"12",md:"6"},{default:l(()=>[i.value.conversion_factor>0?(k(),U(I,{key:0,type:"info",density:"compact"},{default:l(()=>[o(" 1 unit = "+u(i.value.conversion_factor)+" "+u($.value),1)]),_:1})):le("",!0)]),_:1}),a(c,{cols:"12",md:"6"},{default:l(()=>[a(P,{modelValue:i.value.selling_price,"onUpdate:modelValue":t[4]||(t[4]=e=>i.value.selling_price=e),modelModifiers:{number:!0},label:"Selling Price",type:"number",step:"0.01",variant:"outlined",prefix:"₦"},null,8,["modelValue"])]),_:1}),a(c,{cols:"12",md:"6"},{default:l(()=>[a(P,{modelValue:i.value.cost_price,"onUpdate:modelValue":t[5]||(t[5]=e=>i.value.cost_price=e),modelModifiers:{number:!0},label:"Cost Price",type:"number",step:"0.01",variant:"outlined",prefix:"₦"},null,8,["modelValue"])]),_:1}),a(c,{cols:"12",md:"4"},{default:l(()=>[a(w,{modelValue:i.value.is_purchase_unit,"onUpdate:modelValue":t[6]||(t[6]=e=>i.value.is_purchase_unit=e),label:"Purchase Unit",density:"compact"},null,8,["modelValue"])]),_:1}),a(c,{cols:"12",md:"4"},{default:l(()=>[a(w,{modelValue:i.value.is_sale_unit,"onUpdate:modelValue":t[7]||(t[7]=e=>i.value.is_sale_unit=e),label:"Sale Unit",density:"compact"},null,8,["modelValue"])]),_:1}),a(c,{cols:"12",md:"4"},{default:l(()=>[a(w,{modelValue:i.value.is_default,"onUpdate:modelValue":t[8]||(t[8]=e=>i.value.is_default=e),label:"Default Unit",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(ae,null,{default:l(()=>[a(se),a(V,{color:"grey",variant:"text",onClick:t[9]||(t[9]=e=>p.value=!1)},{default:l(()=>[...t[17]||(t[17]=[o("Cancel",-1)])]),_:1}),a(V,{color:"primary",variant:"flat",onClick:L},{default:l(()=>[...t[18]||(t[18]=[o("Save",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{pe as default};
