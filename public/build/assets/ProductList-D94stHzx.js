import{b as we,ac as Pe,r,o as xe,a2 as _,e as Me,f as V,h as t,w as a,V as s,i as M,q,m as f,a4 as N,g as y,j as g,E as z,n as v,p as o,G as c,ad as ue,P as ie,t as n,s as I,W as Q,v as W,k as oe,ae as se,af as Se,a9 as ne,T as J,aa as X,ag as $e,ah as De,M as Ae,ai as Fe,aj as Te,a7 as qe,ak as Y}from"./app-CJq9zEpr.js";import{u as Ne}from"./useToast-DKMsU9PD.js";import{_ as re}from"./CategorySelect-CGcOVtdp.js";import"./AddNewSelect-Cy-bT142.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ze={class:"font-weight-bold"},Ie={class:"text-caption text-grey"},Re={class:"text-h5"},He={__name:"ProductList",setup(Be){const S=we(),{success:k,handleError:C}=Ne(),{confirm:Z}=Pe(),R=r(!1),B=r(!1),w=r(!1),$=r(!1),E=r(""),L=r(null),D=r(null),O=r([]),P=r([]),j=r([]),h=r(0),ee=r(10),de=[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"}],me=[{title:"Product",key:"name",sortable:!0},{title:"Category",key:"category",sortable:!1},{title:"Selling Price",key:"selling_price",sortable:!0},{title:"Cost Price",key:"cost_price",sortable:!0},{title:"Status",key:"is_active",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],ve=[{title:"Weighted Average",value:"weighted_average"},{title:"FIFO (First In First Out)",value:"fifo"}],i=r({name:"",sku:"",category_id:null,unit_id:null,cost_price:0,selling_price:0,barcode:"",description:"",reorder_level:10,reorder_quantity:20,valuation_method:"weighted_average",track_inventory:!0,is_active:!0}),A=u=>new Intl.NumberFormat("en-NG").format(u),b=async()=>{R.value=!0;try{const u={search:E.value,category_id:L.value,is_active:D.value==="active"?1:D.value==="inactive"?0:null,per_page:ee.value},l=await _.get("/api/products",{params:u});O.value=l.data.data||l.data,h.value=l.data.total||O.value.length}catch(u){console.error("Failed to load products:",u)}finally{R.value=!1}},ce=()=>{$.value=!1,i.value={name:"",sku:"",category_id:null,unit_id:null,cost_price:0,selling_price:0,barcode:"",description:"",reorder_level:10,reorder_quantity:20,valuation_method:"weighted_average",track_inventory:!0,is_active:!0},w.value=!0},pe=u=>{$.value=!0,i.value={...u},w.value=!0},le=()=>{w.value=!1},fe=async()=>{B.value=!0;try{$.value?(await _.put(`/api/products/${i.value.id}`,i.value),k("Product updated successfully")):(await _.post("/api/products",i.value),k("Product created successfully")),le(),b()}catch(u){C(u,"Failed to save product")}finally{B.value=!1}},_e=async u=>{if(await Z(`Are you sure you want to delete ${u.name}?`))try{await _.delete(`/api/products/${u.id}`),k("Product deleted successfully"),b()}catch(e){C(e,"Failed to delete product")}},Ve=u=>{console.log("View product:",u)},F=r(!1),U=r(!1),p=r(null),te=r([]),ae=r([]),G=r(!1),H=r(!1),T=r(!1),ye=[{title:"Unit",key:"unit"},{title:"Conversion",key:"conversion_factor"},{title:"Selling Price",key:"selling_price"},{title:"Cost Price",key:"cost_price"},{title:"Purchase",key:"is_purchase_unit"},{title:"Sale",key:"is_sale_unit"},{title:"Default",key:"is_default"},{title:"Actions",key:"actions",sortable:!1}],d=r({unit_id:null,conversion_factor:1,selling_price:0,cost_price:0,is_purchase_unit:!0,is_sale_unit:!0,is_default:!1}),ge=async u=>{p.value=u,F.value=!0,await K()},K=async()=>{if(p.value){G.value=!0;try{const u=await _.get(`/api/products/${p.value.id}/units`);te.value=u.data||[]}catch(u){C(u)}finally{G.value=!1}}},be=()=>{T.value=!1,d.value={unit_id:null,conversion_factor:1,selling_price:0,cost_price:0,is_purchase_unit:!0,is_sale_unit:!0,is_default:!1},U.value=!0},ke=u=>{var l;T.value=!0,d.value={...u,unit_id:u.unit_id||((l=u.unit)==null?void 0:l.id)||u.id},U.value=!0},Ue=async()=>{H.value=!0;try{T.value?(await _.put(`/api/products/${p.value.id}/units/${d.value.id}`,d.value),k("Unit updated successfully")):(await _.post(`/api/products/${p.value.id}/units`,d.value),k("Unit added successfully")),U.value=!1,await K()}catch(u){C(u)}finally{H.value=!1}},Ce=async u=>{var e;if(await Z(`Delete unit ${((e=u.unit)==null?void 0:e.name)||u.name}?`))try{await _.delete(`/api/products/${p.value.id}/units/${u.id}`),k("Unit deleted successfully"),await K()}catch(m){C(m)}};return xe(async()=>{const u=await _.get("/api/categories");P.value=u.data.data||u.data;const l=await _.get("/api/units");j.value=l.data.data||l.data,ae.value=j.value,b()}),(u,l)=>(V(),Me("div",null,[t(q,null,{default:a(()=>[t(s,{cols:"12"},{default:a(()=>[...l[30]||(l[30]=[M("h1",{class:"text-h4 mb-4"},"Products",-1)])]),_:1})]),_:1}),t(q,null,{default:a(()=>[t(s,{cols:"12",md:"4"},{default:a(()=>[t(f,{modelValue:E.value,"onUpdate:modelValue":l[0]||(l[0]=e=>E.value=e),label:"Search products...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:b},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",md:"3"},{default:a(()=>[t(re,{modelValue:L.value,"onUpdate:modelValue":[l[1]||(l[1]=e=>L.value=e),b],items:P.value,"item-title":"name","item-value":"id",label:"Category",variant:"outlined",density:"compact",clearable:"",onCreated:l[2]||(l[2]=e=>P.value.push(e))},null,8,["modelValue","items"])]),_:1}),t(s,{cols:"12",md:"2"},{default:a(()=>[t(N,{modelValue:D.value,"onUpdate:modelValue":[l[3]||(l[3]=e=>D.value=e),b],items:de,label:"Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",md:"3",class:"text-right"},{default:a(()=>[z(S).hasPermission("create_products")?(V(),y(v,{key:0,color:"primary",onClick:ce},{default:a(()=>[t(c,{left:""},{default:a(()=>[...l[31]||(l[31]=[o("mdi-plus",-1)])]),_:1}),l[32]||(l[32]=o(" Add Product ",-1))]),_:1})):g("",!0)]),_:1})]),_:1}),t(I,null,{default:a(()=>[t(ue,{headers:me,items:O.value,loading:R.value,"items-per-page":ee.value,"server-items-length":h.value,"onUpdate:options":b},{"item.name":a(({item:e})=>[M("div",null,[M("div",ze,n(e.name),1),M("div",Ie,n(e.sku),1)])]),"item.category":a(({item:e})=>{var m;return[o(n(((m=e.category)==null?void 0:m.name)||"N/A"),1)]}),"item.selling_price":a(({item:e})=>[o(" ₦"+n(A(e.selling_price)),1)]),"item.cost_price":a(({item:e})=>[o(" ₦"+n(A(e.cost_price)),1)]),"item.is_active":a(({item:e})=>[t(ie,{color:e.is_active?"success":"error",size:"small"},{default:a(()=>[o(n(e.is_active?"Active":"Inactive"),1)]),_:2},1032,["color"])]),"item.actions":a(({item:e})=>[t(v,{icon:"",size:"small",onClick:m=>Ve(e),title:"View"},{default:a(()=>[t(c,null,{default:a(()=>[...l[33]||(l[33]=[o("mdi-eye",-1)])]),_:1})]),_:1},8,["onClick"]),z(S).hasPermission("update_products")?(V(),y(v,{key:0,icon:"",size:"small",onClick:m=>ge(e),title:"Manage Units",color:"info"},{default:a(()=>[t(c,null,{default:a(()=>[...l[34]||(l[34]=[o("mdi-package-variant-closed",-1)])]),_:1})]),_:1},8,["onClick"])):g("",!0),z(S).hasPermission("update_products")?(V(),y(v,{key:1,icon:"",size:"small",onClick:m=>pe(e),title:"Edit"},{default:a(()=>[t(c,null,{default:a(()=>[...l[35]||(l[35]=[o("mdi-pencil",-1)])]),_:1})]),_:1},8,["onClick"])):g("",!0),z(S).hasPermission("delete_products")?(V(),y(v,{key:2,icon:"",size:"small",onClick:m=>_e(e),title:"Delete",color:"error"},{default:a(()=>[t(c,null,{default:a(()=>[...l[36]||(l[36]=[o("mdi-delete",-1)])]),_:1})]),_:1},8,["onClick"])):g("",!0)]),_:1},8,["items","loading","items-per-page","server-items-length"])]),_:1}),t(X,{modelValue:w.value,"onUpdate:modelValue":l[18]||(l[18]=e=>w.value=e),"max-width":"800px",persistent:""},{default:a(()=>[t(I,null,{default:a(()=>[t(Q,null,{default:a(()=>[M("span",Re,n($.value?"Edit Product":"New Product"),1)]),_:1}),t(W,null,{default:a(()=>[t(oe,{ref:"form"},{default:a(()=>[t(q,null,{default:a(()=>[t(s,{cols:"12",md:"6"},{default:a(()=>[t(f,{modelValue:i.value.name,"onUpdate:modelValue":l[4]||(l[4]=e=>i.value.name=e),label:"Product Name *",variant:"outlined",rules:[e=>!!e||"Name is required"]},null,8,["modelValue","rules"])]),_:1}),t(s,{cols:"12",md:"6"},{default:a(()=>[t(f,{modelValue:i.value.sku,"onUpdate:modelValue":l[5]||(l[5]=e=>i.value.sku=e),label:"SKU *",variant:"outlined",rules:[e=>!!e||"SKU is required"]},null,8,["modelValue","rules"])]),_:1}),t(s,{cols:"12",md:"6"},{default:a(()=>[t(re,{modelValue:i.value.category_id,"onUpdate:modelValue":l[6]||(l[6]=e=>i.value.category_id=e),items:P.value,"item-title":"name","item-value":"id",label:"Category *",variant:"outlined",rules:[e=>!!e||"Category is required"],onCreated:l[7]||(l[7]=e=>P.value.push(e))},null,8,["modelValue","items","rules"])]),_:1}),t(s,{cols:"12",md:"6"},{default:a(()=>[t(N,{modelValue:i.value.unit_id,"onUpdate:modelValue":l[8]||(l[8]=e=>i.value.unit_id=e),items:j.value,"item-title":"name","item-value":"id",label:"Unit *",variant:"outlined",rules:[e=>!!e||"Unit is required"]},null,8,["modelValue","items","rules"])]),_:1}),t(s,{cols:"12",md:"6"},{default:a(()=>[t(f,{modelValue:i.value.cost_price,"onUpdate:modelValue":l[9]||(l[9]=e=>i.value.cost_price=e),modelModifiers:{number:!0},label:"Cost Price *",type:"number",variant:"outlined",prefix:"₦",rules:[e=>e>=0||"Must be positive"]},null,8,["modelValue","rules"])]),_:1}),t(s,{cols:"12",md:"6"},{default:a(()=>[t(f,{modelValue:i.value.selling_price,"onUpdate:modelValue":l[10]||(l[10]=e=>i.value.selling_price=e),modelModifiers:{number:!0},label:"Selling Price *",type:"number",variant:"outlined",prefix:"₦",rules:[e=>e>=0||"Must be positive"]},null,8,["modelValue","rules"])]),_:1}),t(s,{cols:"12",md:"6"},{default:a(()=>[t(f,{modelValue:i.value.barcode,"onUpdate:modelValue":l[11]||(l[11]=e=>i.value.barcode=e),label:"Barcode",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",md:"6"},{default:a(()=>[t(N,{modelValue:i.value.valuation_method,"onUpdate:modelValue":l[12]||(l[12]=e=>i.value.valuation_method=e),items:ve,label:"Valuation Method *",variant:"outlined",rules:[e=>!!e||"Required"]},null,8,["modelValue","rules"])]),_:1}),t(s,{cols:"12",md:"4"},{default:a(()=>[t(f,{modelValue:i.value.reorder_level,"onUpdate:modelValue":l[13]||(l[13]=e=>i.value.reorder_level=e),modelModifiers:{number:!0},label:"Reorder Level *",type:"number",variant:"outlined",rules:[e=>e>=0||"Must be positive"],hint:"Minimum stock level before reorder"},null,8,["modelValue","rules"])]),_:1}),t(s,{cols:"12",md:"4"},{default:a(()=>[t(f,{modelValue:i.value.reorder_quantity,"onUpdate:modelValue":l[14]||(l[14]=e=>i.value.reorder_quantity=e),modelModifiers:{number:!0},label:"Reorder Quantity *",type:"number",variant:"outlined",rules:[e=>e>=0||"Must be positive"],hint:"Quantity to order when restocking"},null,8,["modelValue","rules"])]),_:1}),t(s,{cols:"12",md:"4"},{default:a(()=>[t(se,{modelValue:i.value.track_inventory,"onUpdate:modelValue":l[15]||(l[15]=e=>i.value.track_inventory=e),label:"Track Inventory",color:"primary"},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",md:"6"},{default:a(()=>[t(se,{modelValue:i.value.is_active,"onUpdate:modelValue":l[16]||(l[16]=e=>i.value.is_active=e),label:"Active",color:"primary"},null,8,["modelValue"])]),_:1}),t(s,{cols:"12"},{default:a(()=>[t(Se,{modelValue:i.value.description,"onUpdate:modelValue":l[17]||(l[17]=e=>i.value.description=e),label:"Description",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),t(ne,null,{default:a(()=>[t(J),t(v,{onClick:le},{default:a(()=>[...l[37]||(l[37]=[o("Cancel",-1)])]),_:1}),t(v,{color:"primary",onClick:fe,loading:B.value},{default:a(()=>[...l[38]||(l[38]=[o("Save",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(X,{modelValue:F.value,"onUpdate:modelValue":l[20]||(l[20]=e=>F.value=e),"max-width":"900px",persistent:""},{default:a(()=>[p.value?(V(),y(I,{key:0},{default:a(()=>[t(Q,{class:"bg-primary text-white"},{default:a(()=>[o(" Manage Units - "+n(p.value.name)+" ",1),t(v,{icon:"",size:"small",onClick:l[19]||(l[19]=e=>F.value=!1),class:"ml-auto"},{default:a(()=>[t(c,{color:"white"},{default:a(()=>[...l[39]||(l[39]=[o("mdi-close",-1)])]),_:1})]),_:1})]),_:1}),t(W,{class:"mt-4"},{default:a(()=>[t(ue,{headers:ye,items:te.value,loading:G.value,class:"elevation-1 mb-4"},{top:a(()=>[t($e,{flat:""},{default:a(()=>[t(De,null,{default:a(()=>[...l[40]||(l[40]=[o("Product Units",-1)])]),_:1}),t(J),t(v,{color:"primary",onClick:be},{default:a(()=>[t(c,{left:""},{default:a(()=>[...l[41]||(l[41]=[o("mdi-plus",-1)])]),_:1}),l[42]||(l[42]=o(" Add Unit ",-1))]),_:1})]),_:1})]),"item.unit":a(({item:e})=>{var m,x;return[o(n(((m=e.unit)==null?void 0:m.name)||e.name)+" ("+n(((x=e.unit)==null?void 0:x.short_name)||e.short_name)+") ",1)]}),"item.conversion_factor":a(({item:e})=>[t(ie,{color:"info",size:"small"},{default:a(()=>{var m,x;return[o(" 1 "+n(((m=e.unit)==null?void 0:m.short_name)||e.short_name)+" = "+n(e.conversion_factor)+" "+n((x=p.value.unit)==null?void 0:x.short_name),1)]}),_:2},1024)]),"item.selling_price":a(({item:e})=>[o(" ₦"+n(A(e.selling_price||0)),1)]),"item.cost_price":a(({item:e})=>[o(" ₦"+n(A(e.cost_price||0)),1)]),"item.is_purchase_unit":a(({item:e})=>[t(c,{color:e.is_purchase_unit?"success":"grey"},{default:a(()=>[o(n(e.is_purchase_unit?"mdi-check-circle":"mdi-close-circle"),1)]),_:2},1032,["color"])]),"item.is_sale_unit":a(({item:e})=>[t(c,{color:e.is_sale_unit?"success":"grey"},{default:a(()=>[o(n(e.is_sale_unit?"mdi-check-circle":"mdi-close-circle"),1)]),_:2},1032,["color"])]),"item.is_default":a(({item:e})=>[t(c,{color:e.is_default?"warning":"grey"},{default:a(()=>[o(n(e.is_default?"mdi-star":"mdi-star-outline"),1)]),_:2},1032,["color"])]),"item.actions":a(({item:e})=>[e.is_default?g("",!0):(V(),y(v,{key:0,icon:"",size:"small",color:"primary",onClick:m=>ke(e)},{default:a(()=>[t(c,null,{default:a(()=>[...l[43]||(l[43]=[o("mdi-pencil",-1)])]),_:1})]),_:1},8,["onClick"])),e.is_default?g("",!0):(V(),y(v,{key:1,icon:"",size:"small",color:"error",onClick:m=>Ce(e)},{default:a(()=>[t(c,null,{default:a(()=>[...l[44]||(l[44]=[o("mdi-delete",-1)])]),_:1})]),_:1},8,["onClick"]))]),_:1},8,["items","loading"])]),_:1})]),_:1})):g("",!0)]),_:1},8,["modelValue"]),t(X,{modelValue:U.value,"onUpdate:modelValue":l[29]||(l[29]=e=>U.value=e),"max-width":"600px",persistent:""},{default:a(()=>[t(I,null,{default:a(()=>[t(Q,null,{default:a(()=>[o(n(T.value?"Edit":"Add")+" Unit ",1)]),_:1}),t(W,null,{default:a(()=>[t(oe,{ref:"unitForm"},{default:a(()=>[t(q,null,{default:a(()=>[t(s,{cols:"12"},{default:a(()=>[t(N,{modelValue:d.value.unit_id,"onUpdate:modelValue":l[21]||(l[21]=e=>d.value.unit_id=e),items:ae.value,"item-title":"name","item-value":"id",label:"Unit *",variant:"outlined",rules:[e=>!!e||"Required"]},{item:a(({props:e,item:m})=>[t(Ae,Fe(Te(e)),{title:a(()=>[o(n(m.raw.name)+" ("+n(m.raw.short_name)+") ",1)]),_:2},1040)]),_:1},8,["modelValue","items","rules"])]),_:1}),t(s,{cols:"12",md:"6"},{default:a(()=>[t(f,{modelValue:d.value.conversion_factor,"onUpdate:modelValue":l[22]||(l[22]=e=>d.value.conversion_factor=e),modelModifiers:{number:!0},label:"Conversion Factor *",type:"number",step:"0.01",variant:"outlined",rules:[e=>e>0||"Must be > 0"],hint:"How many base units in this unit","persistent-hint":""},null,8,["modelValue","rules"])]),_:1}),t(s,{cols:"12",md:"6"},{default:a(()=>[d.value.conversion_factor>0&&p.value?(V(),y(qe,{key:0,type:"info",density:"compact"},{default:a(()=>{var e;return[o(" 1 unit = "+n(d.value.conversion_factor)+" "+n((e=p.value.unit)==null?void 0:e.short_name),1)]}),_:1})):g("",!0)]),_:1}),t(s,{cols:"12",md:"6"},{default:a(()=>[t(f,{modelValue:d.value.selling_price,"onUpdate:modelValue":l[23]||(l[23]=e=>d.value.selling_price=e),modelModifiers:{number:!0},label:"Selling Price",type:"number",step:"0.01",variant:"outlined",prefix:"₦"},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",md:"6"},{default:a(()=>[t(f,{modelValue:d.value.cost_price,"onUpdate:modelValue":l[24]||(l[24]=e=>d.value.cost_price=e),modelModifiers:{number:!0},label:"Cost Price",type:"number",step:"0.01",variant:"outlined",prefix:"₦"},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",md:"4"},{default:a(()=>[t(Y,{modelValue:d.value.is_purchase_unit,"onUpdate:modelValue":l[25]||(l[25]=e=>d.value.is_purchase_unit=e),label:"Purchase Unit",density:"compact"},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",md:"4"},{default:a(()=>[t(Y,{modelValue:d.value.is_sale_unit,"onUpdate:modelValue":l[26]||(l[26]=e=>d.value.is_sale_unit=e),label:"Sale Unit",density:"compact"},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",md:"4"},{default:a(()=>[t(Y,{modelValue:d.value.is_default,"onUpdate:modelValue":l[27]||(l[27]=e=>d.value.is_default=e),label:"Default Unit",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),t(ne,null,{default:a(()=>[t(J),t(v,{color:"grey",variant:"text",onClick:l[28]||(l[28]=e=>U.value=!1)},{default:a(()=>[...l[45]||(l[45]=[o("Cancel",-1)])]),_:1}),t(v,{color:"primary",variant:"flat",onClick:Ue,loading:H.value},{default:a(()=>[...l[46]||(l[46]=[o("Save",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{He as default};
