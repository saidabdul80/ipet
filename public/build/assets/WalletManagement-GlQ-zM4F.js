import{b as le,ac as oe,r,o as ne,a2 as p,e as se,f as y,h as a,w as t,V as s,i as $,q as C,al as B,p as n,am as ue,an as A,s as D,v as M,a4 as V,ad as re,g,j as T,E as I,n as F,G as x,P as E,t as c,N as de,k as G,m as N,af as O,a7 as j,a9 as H,T as J,ao as ie}from"./app-BU2Ar5cD.js";const fe={__name:"WalletManagement",setup(me){const S=le(),{alert:i,confirm:P}=oe(),b=r("transactions"),U=r(!1),R=r(!1),W=r(!1),q=r([]),_=r([]),f=r(null),v=r({customer_id:null,transaction_type:null,status:null}),u=r({customer_id:null,amount:0,payment_method:"bank_transfer",reference:"",notes:""}),d=r({customer_id:null,amount:0,description:""}),K=[{title:"Credit",value:"credit"},{title:"Debit",value:"debit"}],L=[{title:"Pending",value:"pending"},{title:"Completed",value:"completed"},{title:"Reversed",value:"reversed"}],Q=[{title:"Cash",value:"cash"},{title:"Bank Transfer",value:"bank_transfer"},{title:"Card",value:"card"},{title:"Online Payment",value:"online"}],X=[{title:"Date",key:"transaction_date"},{title:"Customer",key:"customer"},{title:"Type",key:"transaction_type"},{title:"Amount",key:"amount"},{title:"Balance After",key:"balance_after"},{title:"Reference",key:"reference"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],w=o=>new Intl.NumberFormat("en-NG").format(o),Y=o=>o==="credit"?"success":"error",Z=o=>({pending:"warning",completed:"success",reversed:"error"})[o]||"default",m=async()=>{U.value=!0;try{const o=await p.get("/api/wallet/transactions",{params:v.value});q.value=o.data.data||o.data}catch(o){console.error("Failed to load transactions:",o)}finally{U.value=!1}},z=async()=>{const o=u.value.customer_id||d.value.customer_id;if(o)try{const l=await p.get(`/api/wallet/customers/${o}/balance`);f.value=l.data.balance}catch(l){console.error("Failed to load balance:",l)}},h=async()=>{R.value=!0;try{await p.post("/api/wallet/fund",u.value),u.value={customer_id:null,amount:0,payment_method:"bank_transfer",reference:"",notes:""},f.value=null,m(),i("Wallet funded successfully")}catch(o){console.error("Failed to fund wallet:",o),i("Failed to fund wallet")}finally{R.value=!1}},ee=async()=>{W.value=!0;try{await p.post("/api/wallet/debit",d.value),d.value={customer_id:null,amount:0,description:""},f.value=null,m(),i("Wallet debited successfully")}catch(o){console.error("Failed to debit wallet:",o),i("Failed to debit wallet")}finally{W.value=!1}},ae=async o=>{if(await P("Approve this transaction?"))try{await p.post(`/api/wallet/transactions/${o.id}/approve`),m(),i("Transaction approved")}catch(e){console.error("Failed to approve transaction:",e),i("Failed to approve transaction")}},te=async o=>{if(await P("Reverse this transaction? This action cannot be undone."))try{await p.post(`/api/wallet/transactions/${o.id}/reverse`),m(),i("Transaction reversed")}catch(e){console.error("Failed to reverse transaction:",e),i("Failed to reverse transaction")}};return ne(async()=>{const o=await p.get("/api/customers");_.value=o.data.data||o.data,m()}),(o,l)=>(y(),se("div",null,[a(C,null,{default:t(()=>[a(s,{cols:"12"},{default:t(()=>[...l[13]||(l[13]=[$("h1",{class:"text-h4 mb-4"},"Wallet Management",-1)])]),_:1})]),_:1}),a(ue,{modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=e=>b.value=e),color:"primary"},{default:t(()=>[a(B,{value:"transactions"},{default:t(()=>[...l[14]||(l[14]=[n("Transactions",-1)])]),_:1}),a(B,{value:"fund"},{default:t(()=>[...l[15]||(l[15]=[n("Fund Wallet",-1)])]),_:1}),a(B,{value:"debit"},{default:t(()=>[...l[16]||(l[16]=[n("Debit Wallet",-1)])]),_:1})]),_:1},8,["modelValue"]),a(ie,{modelValue:b.value,"onUpdate:modelValue":l[12]||(l[12]=e=>b.value=e),class:"mt-4"},{default:t(()=>[a(A,{value:"transactions"},{default:t(()=>[a(D,null,{default:t(()=>[a(M,null,{default:t(()=>[a(C,null,{default:t(()=>[a(s,{cols:"12",md:"4"},{default:t(()=>[a(V,{modelValue:v.value.customer_id,"onUpdate:modelValue":[l[1]||(l[1]=e=>v.value.customer_id=e),m],items:_.value,"item-title":"name","item-value":"id",label:"Customer",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),a(s,{cols:"12",md:"3"},{default:t(()=>[a(V,{modelValue:v.value.transaction_type,"onUpdate:modelValue":[l[2]||(l[2]=e=>v.value.transaction_type=e),m],items:K,label:"Type",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),a(s,{cols:"12",md:"3"},{default:t(()=>[a(V,{modelValue:v.value.status,"onUpdate:modelValue":[l[3]||(l[3]=e=>v.value.status=e),m],items:L,label:"Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(re,{headers:X,items:q.value,loading:U.value},{"item.customer":t(({item:e})=>{var k;return[n(c((k=e.customer)==null?void 0:k.name),1)]}),"item.transaction_type":t(({item:e})=>[a(E,{color:Y(e.transaction_type),size:"small"},{default:t(()=>[n(c(e.transaction_type),1)]),_:2},1032,["color"])]),"item.amount":t(({item:e})=>[$("span",{class:de(e.transaction_type==="credit"?"text-success":"text-error")},c(e.transaction_type==="credit"?"+":"-")+"₦"+c(w(e.amount)),3)]),"item.balance_after":t(({item:e})=>[n(" ₦"+c(w(e.balance_after)),1)]),"item.status":t(({item:e})=>[a(E,{color:Z(e.status),size:"small"},{default:t(()=>[n(c(e.status),1)]),_:2},1032,["color"])]),"item.actions":t(({item:e})=>[e.status==="pending"&&I(S).hasPermission("approve_wallet_transactions")?(y(),g(F,{key:0,icon:"",size:"small",onClick:k=>ae(e),title:"Approve",color:"success"},{default:t(()=>[a(x,null,{default:t(()=>[...l[17]||(l[17]=[n("mdi-check",-1)])]),_:1})]),_:1},8,["onClick"])):T("",!0),e.status==="completed"&&I(S).hasPermission("reverse_wallet_transactions")?(y(),g(F,{key:1,icon:"",size:"small",onClick:k=>te(e),title:"Reverse",color:"error"},{default:t(()=>[a(x,null,{default:t(()=>[...l[18]||(l[18]=[n("mdi-undo",-1)])]),_:1})]),_:1},8,["onClick"])):T("",!0)]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1}),a(A,{value:"fund"},{default:t(()=>[a(D,null,{default:t(()=>[a(M,null,{default:t(()=>[a(G,{ref:"fundForm"},{default:t(()=>[a(C,null,{default:t(()=>[a(s,{cols:"12",md:"6"},{default:t(()=>[a(V,{modelValue:u.value.customer_id,"onUpdate:modelValue":[l[4]||(l[4]=e=>u.value.customer_id=e),z],items:_.value,"item-title":"name","item-value":"id",label:"Customer *",variant:"outlined",rules:[e=>!!e||"Required"]},null,8,["modelValue","items","rules"])]),_:1}),a(s,{cols:"12",md:"6"},{default:t(()=>[a(N,{modelValue:u.value.amount,"onUpdate:modelValue":l[5]||(l[5]=e=>u.value.amount=e),modelModifiers:{number:!0},label:"Amount *",type:"number",min:"0.01",variant:"outlined",prefix:"₦",rules:[e=>e>0||"Must be greater than 0"]},null,8,["modelValue","rules"])]),_:1}),a(s,{cols:"12",md:"6"},{default:t(()=>[a(V,{modelValue:u.value.payment_method,"onUpdate:modelValue":l[6]||(l[6]=e=>u.value.payment_method=e),items:Q,label:"Payment Method *",variant:"outlined",rules:[e=>!!e||"Required"]},null,8,["modelValue","rules"])]),_:1}),a(s,{cols:"12",md:"6"},{default:t(()=>[a(N,{modelValue:u.value.reference,"onUpdate:modelValue":l[7]||(l[7]=e=>u.value.reference=e),label:"Payment Reference *",variant:"outlined",rules:[e=>!!e||"Required"]},null,8,["modelValue","rules"])]),_:1}),a(s,{cols:"12"},{default:t(()=>[a(O,{modelValue:u.value.notes,"onUpdate:modelValue":l[8]||(l[8]=e=>u.value.notes=e),label:"Notes",variant:"outlined",rows:"2"},null,8,["modelValue"])]),_:1}),f.value!==null?(y(),g(s,{key:0,cols:"12"},{default:t(()=>[a(j,{type:"info"},{default:t(()=>[n(" Current Balance: ₦"+c(w(f.value)),1)]),_:1})]),_:1})):T("",!0)]),_:1})]),_:1},512)]),_:1}),a(H,null,{default:t(()=>[a(J),a(F,{color:"primary",onClick:h,loading:R.value},{default:t(()=>[a(x,{left:""},{default:t(()=>[...l[19]||(l[19]=[n("mdi-plus-circle",-1)])]),_:1}),l[20]||(l[20]=n(" Fund Wallet ",-1))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),a(A,{value:"debit"},{default:t(()=>[a(D,null,{default:t(()=>[a(M,null,{default:t(()=>[a(G,{ref:"debitForm"},{default:t(()=>[a(C,null,{default:t(()=>[a(s,{cols:"12",md:"6"},{default:t(()=>[a(V,{modelValue:d.value.customer_id,"onUpdate:modelValue":[l[9]||(l[9]=e=>d.value.customer_id=e),z],items:_.value,"item-title":"name","item-value":"id",label:"Customer *",variant:"outlined",rules:[e=>!!e||"Required"]},null,8,["modelValue","items","rules"])]),_:1}),a(s,{cols:"12",md:"6"},{default:t(()=>[a(N,{modelValue:d.value.amount,"onUpdate:modelValue":l[10]||(l[10]=e=>d.value.amount=e),modelModifiers:{number:!0},label:"Amount *",type:"number",min:"0.01",variant:"outlined",prefix:"₦",rules:[e=>e>0||"Must be greater than 0"]},null,8,["modelValue","rules"])]),_:1}),a(s,{cols:"12"},{default:t(()=>[a(O,{modelValue:d.value.description,"onUpdate:modelValue":l[11]||(l[11]=e=>d.value.description=e),label:"Description *",variant:"outlined",rows:"2",rules:[e=>!!e||"Required"]},null,8,["modelValue","rules"])]),_:1}),f.value!==null?(y(),g(s,{key:0,cols:"12"},{default:t(()=>[a(j,{type:"info"},{default:t(()=>[n(" Current Balance: ₦"+c(w(f.value)),1)]),_:1})]),_:1})):T("",!0)]),_:1})]),_:1},512)]),_:1}),a(H,null,{default:t(()=>[a(J),a(F,{color:"error",onClick:ee,loading:W.value},{default:t(()=>[a(x,{left:""},{default:t(()=>[...l[21]||(l[21]=[n("mdi-minus-circle",-1)])]),_:1}),l[22]||(l[22]=n(" Debit Wallet ",-1))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{fe as default};
