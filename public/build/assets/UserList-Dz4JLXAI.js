import{b as ee,ac as ae,r as n,o as le,e as u,f as i,h as t,w as s,V as _,i as I,q as M,m as U,a4 as h,g as f,j as T,E as w,n as k,p as d,G as q,ad as te,P as y,t as c,J as N,K as R,s as L,W as se,v as oe,k as ie,ae as re,a9 as ne,T as de,aa as ue,a2 as v}from"./app-CJq9zEpr.js";import{u as me}from"./useToast-DKMsU9PD.js";import{_ as j}from"./StoreSelect-CUGTwINW.js";import"./AddNewSelect-Cy-bT142.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ce={key:0},ve={key:1},pe={key:2,class:"text-grey"},fe={key:0},ye={key:1},Ve={key:2,class:"text-grey"},be={class:"text-h5"},Ce={__name:"UserList",setup(_e){const g=ee(),{success:C,handleError:S}=me(),{confirm:G}=ae(),x=n(!1),A=n(!1),V=n(!1),m=n(!1),P=n(""),B=n(null),F=n(null),$=n([]),z=n([]),D=n([]),b=n([]),J=[{title:"Name",key:"name"},{title:"Email",key:"email"},{title:"Role",key:"roles"},{title:"Branch",key:"branch"},{title:"Store",key:"store"},{title:"Status",key:"is_active"},{title:"Actions",key:"actions",sortable:!1}],o=n({name:"",email:"",password:"",role:"",branch_id:null,store_id:null,branch_ids:[],store_ids:[],is_active:!0}),p=async()=>{x.value=!0;try{const l={search:P.value,role:B.value,is_active:F.value},a=await v.get("/api/users",{params:l});$.value=a.data.data||a.data}catch(l){S(l,"Failed to load users")}finally{x.value=!1}},K=async()=>{try{const l=await v.get("/api/roles");z.value=l.data}catch(l){console.error("Failed to load roles:",l)}},W=async()=>{try{const l=await v.get("/api/branches",{params:{per_page:100}});D.value=l.data.data||l.data}catch(l){console.error("Failed to load branches:",l)}},H=async()=>{try{const l=await v.get("/api/stores",{params:{per_page:100}});b.value=l.data.data||l.data}catch(l){console.error("Failed to load stores:",l)}},Q=()=>{m.value=!1,o.value={name:"",email:"",password:"",role:"",branch_id:null,store_id:null,branch_ids:[],store_ids:[],is_active:!0},V.value=!0},X=l=>{var a,e,r;m.value=!0,o.value={id:l.id,name:l.name,email:l.email,password:"",role:((a=l.roles[0])==null?void 0:a.name)||"",branch_id:l.branch_id,store_id:l.store_id,branch_ids:((e=l.branches)==null?void 0:e.map(E=>E.id))||[],store_ids:((r=l.stores)==null?void 0:r.map(E=>E.id))||[],is_active:l.is_active},V.value=!0},O=()=>{V.value=!1},Y=async()=>{A.value=!0;try{const l={...o.value};m.value&&!l.password&&delete l.password,m.value?(await v.put(`/api/users/${o.value.id}`,l),C("User updated successfully")):(await v.post("/api/users",l),C("User created successfully")),O(),p()}catch(l){S(l,"Failed to save user")}finally{A.value=!1}},Z=async l=>{if(await G(`Are you sure you want to delete ${l.name}?`))try{await v.delete(`/api/users/${l.id}`),C("User deleted successfully"),p()}catch(e){S(e,"Failed to delete user")}};return le(async()=>{await Promise.all([p(),K(),W(),H()])}),(l,a)=>(i(),u("div",null,[t(M,null,{default:s(()=>[t(_,{cols:"12"},{default:s(()=>[...a[15]||(a[15]=[I("h1",{class:"text-h4 mb-4"},"User Management",-1)])]),_:1})]),_:1}),t(M,null,{default:s(()=>[t(_,{cols:"12",md:"4"},{default:s(()=>[t(U,{modelValue:P.value,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value=e),label:"Search users...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:p},null,8,["modelValue"])]),_:1}),t(_,{cols:"12",md:"3"},{default:s(()=>[t(h,{modelValue:B.value,"onUpdate:modelValue":[a[1]||(a[1]=e=>B.value=e),p],items:z.value,"item-title":"name","item-value":"name",label:"Role",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),t(_,{cols:"12",md:"2"},{default:s(()=>[t(h,{modelValue:F.value,"onUpdate:modelValue":[a[2]||(a[2]=e=>F.value=e),p],items:[{title:"Active",value:!0},{title:"Inactive",value:!1}],label:"Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),t(_,{cols:"12",md:"3",class:"text-right"},{default:s(()=>[w(g).hasPermission("create_users")?(i(),f(k,{key:0,color:"primary",onClick:Q},{default:s(()=>[t(q,{left:""},{default:s(()=>[...a[16]||(a[16]=[d("mdi-plus",-1)])]),_:1}),a[17]||(a[17]=d(" Add User ",-1))]),_:1})):T("",!0)]),_:1})]),_:1}),t(L,null,{default:s(()=>[t(te,{headers:J,items:$.value,loading:x.value,class:"elevation-1"},{"item.roles":s(({item:e})=>[(i(!0),u(N,null,R(e.roles,r=>(i(),f(y,{key:r.id,size:"small",color:"primary",class:"mr-1"},{default:s(()=>[d(c(r.name),1)]),_:2},1024))),128))]),"item.branch":s(({item:e})=>[e.branches&&e.branches.length>0?(i(),u("div",ce,[(i(!0),u(N,null,R(e.branches,r=>(i(),f(y,{key:r.id,size:"small",class:"mr-1 mb-1"},{default:s(()=>[d(c(r.name),1)]),_:2},1024))),128))])):e.branch?(i(),u("div",ve,[t(y,{size:"small"},{default:s(()=>[d(c(e.branch.name),1)]),_:2},1024)])):(i(),u("span",pe,"All Branches"))]),"item.store":s(({item:e})=>[e.stores&&e.stores.length>0?(i(),u("div",fe,[(i(!0),u(N,null,R(e.stores,r=>(i(),f(y,{key:r.id,size:"small",class:"mr-1 mb-1"},{default:s(()=>[d(c(r.name),1)]),_:2},1024))),128))])):e.store?(i(),u("div",ye,[t(y,{size:"small"},{default:s(()=>[d(c(e.store.name),1)]),_:2},1024)])):(i(),u("span",Ve,"All Stores"))]),"item.is_active":s(({item:e})=>[t(y,{color:e.is_active?"success":"error",size:"small"},{default:s(()=>[d(c(e.is_active?"Active":"Inactive"),1)]),_:2},1032,["color"])]),"item.actions":s(({item:e})=>[w(g).hasPermission("update_users")?(i(),f(k,{key:0,icon:"",size:"small",onClick:r=>X(e),title:"Edit"},{default:s(()=>[t(q,null,{default:s(()=>[...a[18]||(a[18]=[d("mdi-pencil",-1)])]),_:1})]),_:1},8,["onClick"])):T("",!0),w(g).hasPermission("delete_users")&&e.id!==w(g).user.id?(i(),f(k,{key:1,icon:"",size:"small",onClick:r=>Z(e),title:"Delete",color:"error"},{default:s(()=>[t(q,null,{default:s(()=>[...a[19]||(a[19]=[d("mdi-delete",-1)])]),_:1})]),_:1},8,["onClick"])):T("",!0)]),_:1},8,["items","loading"])]),_:1}),t(ue,{modelValue:V.value,"onUpdate:modelValue":a[14]||(a[14]=e=>V.value=e),"max-width":"600px",persistent:""},{default:s(()=>[t(L,null,{default:s(()=>[t(se,null,{default:s(()=>[I("span",be,c(m.value?"Edit User":"Create User"),1)]),_:1}),t(oe,null,{default:s(()=>[t(ie,{ref:"form"},{default:s(()=>[t(U,{modelValue:o.value.name,"onUpdate:modelValue":a[3]||(a[3]=e=>o.value.name=e),label:"Full Name",variant:"outlined",density:"compact",required:""},null,8,["modelValue"]),t(U,{modelValue:o.value.email,"onUpdate:modelValue":a[4]||(a[4]=e=>o.value.email=e),label:"Email",type:"email",variant:"outlined",density:"compact",required:""},null,8,["modelValue"]),t(U,{modelValue:o.value.password,"onUpdate:modelValue":a[5]||(a[5]=e=>o.value.password=e),label:m.value?"Password (leave blank to keep current)":"Password",type:"password",variant:"outlined",density:"compact",required:!m.value},null,8,["modelValue","label","required"]),t(h,{modelValue:o.value.role,"onUpdate:modelValue":a[6]||(a[6]=e=>o.value.role=e),items:z.value,"item-title":"name","item-value":"name",label:"Role",variant:"outlined",density:"compact",required:""},null,8,["modelValue","items"]),t(h,{modelValue:o.value.branch_id,"onUpdate:modelValue":a[7]||(a[7]=e=>o.value.branch_id=e),items:D.value,"item-title":"name","item-value":"id",label:"Primary Branch (Optional)",variant:"outlined",density:"compact",clearable:"",hint:"Primary branch for the user","persistent-hint":""},null,8,["modelValue","items"]),t(h,{modelValue:o.value.branch_ids,"onUpdate:modelValue":a[8]||(a[8]=e=>o.value.branch_ids=e),items:D.value,"item-title":"name","item-value":"id",label:"Additional Branches (Optional)",variant:"outlined",density:"compact",multiple:"",chips:"",clearable:"",hint:"User can access these branches","persistent-hint":"",class:"mt-4"},null,8,["modelValue","items"]),t(j,{modelValue:o.value.store_id,"onUpdate:modelValue":a[9]||(a[9]=e=>o.value.store_id=e),items:b.value,"item-title":"name","item-value":"id",label:"Primary Store (Optional)",variant:"outlined",density:"compact",clearable:"",hint:"Primary store for POS and operations","persistent-hint":"",class:"mt-4",onCreated:a[10]||(a[10]=e=>b.value.push(e))},null,8,["modelValue","items"]),t(j,{modelValue:o.value.store_ids,"onUpdate:modelValue":a[11]||(a[11]=e=>o.value.store_ids=e),items:b.value,"item-title":"name","item-value":"id",label:"Additional Stores (Optional)",variant:"outlined",density:"compact",multiple:"",chips:"",clearable:"",hint:"User can access these stores","persistent-hint":"",class:"mt-4",onCreated:a[12]||(a[12]=e=>b.value.push(e))},null,8,["modelValue","items"]),t(re,{modelValue:o.value.is_active,"onUpdate:modelValue":a[13]||(a[13]=e=>o.value.is_active=e),label:"Active",color:"primary"},null,8,["modelValue"])]),_:1},512)]),_:1}),t(ne,null,{default:s(()=>[t(de),t(k,{text:"",onClick:O},{default:s(()=>[...a[20]||(a[20]=[d("Cancel",-1)])]),_:1}),t(k,{color:"primary",onClick:Y,loading:A.value},{default:s(()=>[...a[21]||(a[21]=[d("Save",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ce as default};
