import{aw as F,c as j,r,e as E,f as K,h as a,X as O,w as o,s as I,W as L,p as w,v as Q,k as W,q as X,V as d,m as n,a4 as _,ae as A,af as z,a9 as G,T as H,n as C,aa as J,a2 as U}from"./app-CJq9zEpr.js";import{u as Y}from"./useToast-DKMsU9PD.js";import{A as Z}from"./AddNewSelect-Cy-bT142.js";const le=Object.assign({inheritAttrs:!1},{__name:"ProductSelect",props:{modelValue:{type:[String,Number,Array,Object,Boolean,null],default:null},items:{type:Array,default:()=>[]},label:{type:String,default:"Product"},addNewText:{type:String,default:"Add New Product"},control:{type:String,default:"select"},showAddNew:{type:Boolean,default:!0}},emits:["update:modelValue","created"],setup(i,{emit:M}){const p=M,N=F(),S=j(()=>{const{"onUpdate:modelValue":u,"onUpdate:model-value":l,...e}=N;return e}),{success:P,handleError:c}=Y(),s=r(!1),V=r(!1),m=r(null),f=r([]),g=r([]),y=r(!1),b=r(!1),T=["weighted_average","fifo"],t=r({name:"",sku:"",barcode:"",category_id:null,unit_id:null,cost_price:0,selling_price:0,reorder_level:0,reorder_quantity:0,valuation_method:"weighted_average",track_inventory:!0,is_active:!0,description:""}),q=async()=>{s.value=!0,f.value.length||await R(),g.value.length||await B()},x=()=>{var u;s.value=!1,t.value={name:"",sku:"",barcode:"",category_id:null,unit_id:null,cost_price:0,selling_price:0,reorder_level:0,reorder_quantity:0,valuation_method:"weighted_average",track_inventory:!0,is_active:!0,description:""},(u=m.value)!=null&&u.resetValidation&&m.value.resetValidation()},R=async()=>{y.value=!0;try{const u=await U.get("/api/units",{params:{per_page:1e3}});f.value=u.data.data||u.data}catch(u){c(u,"Failed to load units")}finally{y.value=!1}},B=async()=>{b.value=!0;try{const u=await U.get("/api/categories",{params:{per_page:1e3}});g.value=u.data.data||u.data}catch(u){c(u,"Failed to load categories")}finally{b.value=!1}},D=async()=>{var l,e;const u=await((l=m.value)==null?void 0:l.validate());if(!(u===!1||(u==null?void 0:u.valid)===!1)){V.value=!0;try{const v=await U.post("/api/products",t.value),k=((e=v.data)==null?void 0:e.product)||v.data;P("Product created successfully"),p("created",k),p("update:modelValue",k.id),x()}catch(v){c(v,"Failed to create product")}finally{V.value=!1}}};return(u,l)=>(K(),E("div",null,[a(Z,O(S.value,{"model-value":i.modelValue,items:i.items,label:i.label,"add-new-text":i.addNewText,control:i.control,"show-add-new":i.showAddNew,"onUpdate:modelValue":l[0]||(l[0]=e=>p("update:modelValue",e)),onAddNew:q}),null,16,["model-value","items","label","add-new-text","control","show-add-new"]),a(J,{modelValue:s.value,"onUpdate:modelValue":l[14]||(l[14]=e=>s.value=e),"max-width":"900px",persistent:""},{default:o(()=>[a(I,null,{default:o(()=>[a(L,null,{default:o(()=>[...l[15]||(l[15]=[w("New Product",-1)])]),_:1}),a(Q,null,{default:o(()=>[a(W,{ref_key:"form",ref:m},{default:o(()=>[a(X,null,{default:o(()=>[a(d,{cols:"12",md:"6"},{default:o(()=>[a(n,{modelValue:t.value.name,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.name=e),label:"Product Name *",variant:"outlined",rules:[e=>!!e||"Required"]},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"12",md:"6"},{default:o(()=>[a(n,{modelValue:t.value.sku,"onUpdate:modelValue":l[2]||(l[2]=e=>t.value.sku=e),label:"SKU *",variant:"outlined",rules:[e=>!!e||"Required"]},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"12",md:"6"},{default:o(()=>[a(_,{modelValue:t.value.category_id,"onUpdate:modelValue":l[3]||(l[3]=e=>t.value.category_id=e),items:g.value,"item-title":"name","item-value":"id",label:"Category",variant:"outlined",clearable:"",loading:b.value},null,8,["modelValue","items","loading"])]),_:1}),a(d,{cols:"12",md:"6"},{default:o(()=>[a(_,{modelValue:t.value.unit_id,"onUpdate:modelValue":l[4]||(l[4]=e=>t.value.unit_id=e),items:f.value,"item-title":"name","item-value":"id",label:"Unit *",variant:"outlined",rules:[e=>!!e||"Required"],loading:y.value},null,8,["modelValue","items","rules","loading"])]),_:1}),a(d,{cols:"12",md:"6"},{default:o(()=>[a(n,{modelValue:t.value.cost_price,"onUpdate:modelValue":l[5]||(l[5]=e=>t.value.cost_price=e),modelModifiers:{number:!0},label:"Cost Price *",type:"number",variant:"outlined",prefix:"₦",rules:[e=>e>=0||"Must be positive"]},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"12",md:"6"},{default:o(()=>[a(n,{modelValue:t.value.selling_price,"onUpdate:modelValue":l[6]||(l[6]=e=>t.value.selling_price=e),modelModifiers:{number:!0},label:"Selling Price *",type:"number",variant:"outlined",prefix:"₦",rules:[e=>e>=t.value.cost_price||"Must be >= cost price"]},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"12",md:"6"},{default:o(()=>[a(n,{modelValue:t.value.barcode,"onUpdate:modelValue":l[7]||(l[7]=e=>t.value.barcode=e),label:"Barcode",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(d,{cols:"12",md:"6"},{default:o(()=>[a(_,{modelValue:t.value.valuation_method,"onUpdate:modelValue":l[8]||(l[8]=e=>t.value.valuation_method=e),items:T,label:"Valuation Method *",variant:"outlined",rules:[e=>!!e||"Required"]},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"12",md:"6"},{default:o(()=>[a(n,{modelValue:t.value.reorder_level,"onUpdate:modelValue":l[9]||(l[9]=e=>t.value.reorder_level=e),modelModifiers:{number:!0},label:"Reorder Level *",type:"number",variant:"outlined",rules:[e=>e>=0||"Must be positive"]},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"12",md:"6"},{default:o(()=>[a(n,{modelValue:t.value.reorder_quantity,"onUpdate:modelValue":l[10]||(l[10]=e=>t.value.reorder_quantity=e),modelModifiers:{number:!0},label:"Reorder Quantity *",type:"number",variant:"outlined",rules:[e=>e>=0||"Must be positive"]},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"12",md:"6"},{default:o(()=>[a(A,{modelValue:t.value.track_inventory,"onUpdate:modelValue":l[11]||(l[11]=e=>t.value.track_inventory=e),label:"Track Inventory",color:"primary"},null,8,["modelValue"])]),_:1}),a(d,{cols:"12",md:"6"},{default:o(()=>[a(A,{modelValue:t.value.is_active,"onUpdate:modelValue":l[12]||(l[12]=e=>t.value.is_active=e),label:"Active",color:"primary"},null,8,["modelValue"])]),_:1}),a(d,{cols:"12"},{default:o(()=>[a(z,{modelValue:t.value.description,"onUpdate:modelValue":l[13]||(l[13]=e=>t.value.description=e),label:"Description",variant:"outlined",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(G,null,{default:o(()=>[a(H),a(C,{onClick:x},{default:o(()=>[...l[16]||(l[16]=[w("Cancel",-1)])]),_:1}),a(C,{color:"primary",loading:V.value,onClick:D},{default:o(()=>[...l[17]||(l[17]=[w("Save",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{le as _};
