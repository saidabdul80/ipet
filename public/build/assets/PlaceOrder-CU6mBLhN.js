import{a as R,r as u,ac as j,c as E,o as H,e as m,f as n,h as t,w as l,V as r,i as f,q as v,s as w,W as O,m as T,v as g,J as S,K as U,g as x,j as h,t as i,a9 as B,n as k,p as o,G as p,T as J,I as K,M as Q,Z as W,_ as Z,H as X,af as Y,a2 as L}from"./app-BU2Ar5cD.js";import{_ as ee}from"./DatePickerField-DWptZlfj.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"text-h6"},ae={class:"text-caption text-grey"},se={class:"text-h6 text-primary mt-2"},oe={key:0,class:"text-caption"},de={key:1,class:"text-center text-grey py-8"},ne={__name:"PlaceOrder",setup(re){const z=R(),b=u(""),D=u([]),d=u([]),c=u(""),y=u(""),_=u(""),{alert:V}=j(),C=u(!1),A=E(()=>d.value.reduce((s,e)=>s+e.quantity*e.selling_price,0)),q=s=>new Intl.NumberFormat("en-NG").format(s),N=async()=>{try{const s={search:b.value,per_page:12},e=await L.get("/api/products",{params:s});D.value=e.data.data||e.data}catch(s){console.error("Failed to search products:",s)}},M=s=>{const e=d.value.find(a=>a.id===s.id);e?e.quantity<s.stock_quantity?e.quantity++:V("Cannot add more than available stock"):d.value.push({...s,quantity:1})},$=s=>{d.value.splice(s,1)},P=()=>{d.value=[]},G=async()=>{if(!c.value){V("Please enter delivery address");return}C.value=!0;try{const s={delivery_address:c.value,delivery_date:y.value,notes:_.value,items:d.value.map(e=>({product_id:e.id,quantity:e.quantity,unit_price:e.selling_price}))};await L.post("/api/orders",s),V("Order placed successfully!"),P(),c.value="",y.value="",_.value="",z.push("/customer-portal/orders")}catch(s){console.error("Failed to place order:",s),V("Failed to place order. Please try again.")}finally{C.value=!1}};return H(()=>{N()}),(s,e)=>(n(),m("div",null,[t(v,null,{default:l(()=>[t(r,{cols:"12"},{default:l(()=>[...e[4]||(e[4]=[f("h1",{class:"text-h4 mb-4"},"Place Order",-1)])]),_:1})]),_:1}),t(v,null,{default:l(()=>[t(r,{cols:"12",md:"8"},{default:l(()=>[t(w,null,{default:l(()=>[t(O,null,{default:l(()=>[t(T,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),label:"Search products...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:N},null,8,["modelValue"])]),_:1}),t(g,null,{default:l(()=>[t(v,null,{default:l(()=>[(n(!0),m(S,null,U(D.value,a=>(n(),x(r,{key:a.id,cols:"12",md:"4"},{default:l(()=>[t(w,{variant:"outlined",class:"product-card"},{default:l(()=>[t(g,null,{default:l(()=>[f("div",le,i(a.name),1),f("div",ae,i(a.sku),1),f("div",se," ₦"+i(q(a.selling_price)),1),a.stock_quantity?(n(),m("div",oe," In Stock: "+i(a.stock_quantity),1)):h("",!0)]),_:2},1024),t(B,null,{default:l(()=>[t(k,{color:"primary",block:"",onClick:I=>M(a),disabled:!a.stock_quantity||a.stock_quantity===0},{default:l(()=>[t(p,{left:""},{default:l(()=>[...e[5]||(e[5]=[o("mdi-cart-plus",-1)])]),_:1}),e[6]||(e[6]=o(" Add to Cart ",-1))]),_:1},8,["onClick","disabled"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),t(r,{cols:"12",md:"4"},{default:l(()=>[t(w,null,{default:l(()=>[t(O,{class:"bg-primary text-white"},{default:l(()=>[e[8]||(e[8]=o(" Shopping Cart ",-1)),t(J),d.value.length>0?(n(),x(k,{key:0,icon:"",size:"small",onClick:P},{default:l(()=>[t(p,null,{default:l(()=>[...e[7]||(e[7]=[o("mdi-delete",-1)])]),_:1})]),_:1})):h("",!0)]),_:1}),t(g,{style:{"max-height":"400px","overflow-y":"auto"}},{default:l(()=>[d.value.length>0?(n(),x(K,{key:0},{default:l(()=>[(n(!0),m(S,null,U(d.value,(a,I)=>(n(),x(Q,{key:I},{append:l(()=>[t(k,{icon:"",size:"small",onClick:F=>$(I)},{default:l(()=>[t(p,null,{default:l(()=>[...e[9]||(e[9]=[o("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:l(()=>[t(W,null,{default:l(()=>[o(i(a.name),1)]),_:2},1024),t(Z,null,{default:l(()=>[t(v,{align:"center",class:"mt-2"},{default:l(()=>[t(r,{cols:"6"},{default:l(()=>[t(T,{modelValue:a.quantity,"onUpdate:modelValue":F=>a.quantity=F,modelModifiers:{number:!0},type:"number",min:"1",max:a.stock_quantity,density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024),t(r,{cols:"6",class:"text-right"},{default:l(()=>[o(" ₦"+i(q(a.quantity*a.selling_price)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),m("div",de,[t(p,{size:"64"},{default:l(()=>[...e[10]||(e[10]=[o("mdi-cart-outline",-1)])]),_:1}),e[11]||(e[11]=f("div",{class:"mt-2"},"Cart is empty",-1))]))]),_:1}),t(X),t(g,null,{default:l(()=>[t(v,null,{default:l(()=>[t(r,{cols:"6",class:"text-h6"},{default:l(()=>[...e[12]||(e[12]=[o("Total:",-1)])]),_:1}),t(r,{cols:"6",class:"text-right text-h6 text-primary"},{default:l(()=>[o(" ₦"+i(q(A.value)),1)]),_:1})]),_:1}),t(T,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),label:"Delivery Address *",variant:"outlined",density:"compact",class:"mt-2"},null,8,["modelValue"]),t(ee,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=a=>y.value=a),label:"Preferred Delivery Date",variant:"outlined",density:"compact"},null,8,["modelValue"]),t(Y,{modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=a=>_.value=a),label:"Order Notes",variant:"outlined",rows:"2"},null,8,["modelValue"])]),_:1}),t(B,null,{default:l(()=>[t(k,{block:"",color:"success",size:"large",disabled:d.value.length===0||!c.value,loading:C.value,onClick:G},{default:l(()=>[t(p,{left:""},{default:l(()=>[...e[13]||(e[13]=[o("mdi-check",-1)])]),_:1}),e[14]||(e[14]=o(" Place Order ",-1))]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]))}},me=te(ne,[["__scopeId","data-v-de4be23e"]]);export{me as default};
