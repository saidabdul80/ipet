import{aw as je,c as ze,r as V,e as C,f,h as t,X as se,w as a,s as z,W as K,p as n,v as W,k as te,q as O,V as i,m as R,ae as Be,af as ae,a9 as H,T as J,n as _,aa as X,a2 as $,b as Qe,ac as Le,o as Ke,i as r,a4 as ne,g as k,j as g,E as G,G as U,ad as We,P as we,t as p,H as j,au as xe,J as Z,K as ee,a7 as le,M as ke}from"./app-CJq9zEpr.js";import{_ as re}from"./StoreSelect-CUGTwINW.js";import{u as He}from"./useToast-DKMsU9PD.js";import{A as Je}from"./AddNewSelect-Cy-bT142.js";import{_ as Pe}from"./ProductSelect-DyxRNbyB.js";import{_ as L}from"./DatePickerField-ViH1nrtl.js";import{_ as Xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ue=Object.assign({inheritAttrs:!1},{__name:"SupplierSelect",props:{modelValue:{type:[String,Number,Array,Object,Boolean,null],default:null},items:{type:Array,default:()=>[]},label:{type:String,default:"Supplier"},addNewText:{type:String,default:"Add New Supplier"},control:{type:String,default:"select"},showAddNew:{type:Boolean,default:!0}},emits:["update:modelValue","created"],setup(M,{emit:N}){const x=N,h=je(),B=ze(()=>{const{"onUpdate:modelValue":w,"onUpdate:model-value":d,...m}=h;return m}),{success:I,handleError:Q}=He(),P=V(!1),A=V(!1),q=V(null),b=V({name:"",phone:"",email:"",address:"",is_active:!0}),Y=()=>{P.value=!0},S=()=>{var w;P.value=!1,b.value={name:"",phone:"",email:"",address:"",is_active:!0},(w=q.value)!=null&&w.resetValidation&&q.value.resetValidation()},E=async()=>{var d,m;const w=await((d=q.value)==null?void 0:d.validate());if(!(w===!1||(w==null?void 0:w.valid)===!1)){A.value=!0;try{const v=await $.post("/api/suppliers",b.value),c=((m=v.data)==null?void 0:m.supplier)||v.data;I("Supplier created successfully"),x("created",c),x("update:modelValue",c.id),S()}catch(v){Q(v,"Failed to create supplier")}finally{A.value=!1}}};return(w,d)=>(f(),C("div",null,[t(Je,se(B.value,{"model-value":M.modelValue,items:M.items,label:M.label,"add-new-text":M.addNewText,control:M.control,"show-add-new":M.showAddNew,"onUpdate:modelValue":d[0]||(d[0]=m=>x("update:modelValue",m)),onAddNew:Y}),null,16,["model-value","items","label","add-new-text","control","show-add-new"]),t(X,{modelValue:P.value,"onUpdate:modelValue":d[6]||(d[6]=m=>P.value=m),"max-width":"600px",persistent:""},{default:a(()=>[t(z,null,{default:a(()=>[t(K,null,{default:a(()=>[...d[7]||(d[7]=[n("New Supplier",-1)])]),_:1}),t(W,null,{default:a(()=>[t(te,{ref_key:"form",ref:q},{default:a(()=>[t(O,null,{default:a(()=>[t(i,{cols:"12",md:"6"},{default:a(()=>[t(R,{modelValue:b.value.name,"onUpdate:modelValue":d[1]||(d[1]=m=>b.value.name=m),label:"Supplier Name *",variant:"outlined",rules:[m=>!!m||"Required"]},null,8,["modelValue","rules"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(R,{modelValue:b.value.phone,"onUpdate:modelValue":d[2]||(d[2]=m=>b.value.phone=m),label:"Phone *",variant:"outlined",rules:[m=>!!m||"Required"]},null,8,["modelValue","rules"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(R,{modelValue:b.value.email,"onUpdate:modelValue":d[3]||(d[3]=m=>b.value.email=m),label:"Email",variant:"outlined",type:"email"},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(Be,{modelValue:b.value.is_active,"onUpdate:modelValue":d[4]||(d[4]=m=>b.value.is_active=m),label:"Active",color:"primary"},null,8,["modelValue"])]),_:1}),t(i,{cols:"12"},{default:a(()=>[t(ae,{modelValue:b.value.address,"onUpdate:modelValue":d[5]||(d[5]=m=>b.value.address=m),label:"Address",variant:"outlined",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),t(H,null,{default:a(()=>[t(J),t(_,{onClick:S},{default:a(()=>[...d[8]||(d[8]=[n("Cancel",-1)])]),_:1}),t(_,{color:"primary",loading:A.value,onClick:E},{default:a(()=>[...d[9]||(d[9]=[n("Save",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),he=["onClick"],Ye={key:0,class:"text-caption text-grey ml-1"},Ze={class:"d-flex justify-space-between mb-2"},el={class:"d-flex justify-space-between mb-2"},ll={class:"d-flex justify-space-between text-h6"},tl={class:"text-primary"},al={class:"d-flex justify-space-between align-center mb-2"},ol={key:0,class:"text-caption text-grey"},ul={key:1,class:"text-right mt-4"},dl={class:"d-flex justify-space-between align-center mb-2"},nl={key:0,class:"text-caption text-grey"},rl={key:1,class:"text-right mt-4"},sl={__name:"PurchaseOrderList",setup(M){const N=Qe(),{alert:x,confirm:h}=Le(),B=V(!1),I=V(!1),Q=V(!1),P=V(!1),A=V(!1),q=V(!1),b=V(!1),Y=V([]),S=V([]),E=V([]),w=V([]),d=V(null),m=V({search:"",status:null,store_id:null}),v=V({supplier_id:null,store_id:null,expected_date:"",notes:""}),c=V({id:null,po_number:"",supplier_id:null,store_id:null,order_date:"",expected_date:"",notes:"",items:[]}),D=V({grn_number:"",received_date:new Date().toISOString().split("T")[0],notes:""}),Ce=[{title:"Pending",value:"pending"},{title:"Approved",value:"approved"},{title:"Received",value:"received"},{title:"Cancelled",value:"cancelled"}],$e=[{title:"PO #",key:"po_number"},{title:"Date",key:"po_date"},{title:"Supplier",key:"supplier"},{title:"Total",key:"total_amount"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],T=o=>new Intl.NumberFormat("en-NG").format(o),ie=o=>({pending:"warning",approved:"info",received:"success",cancelled:"error"})[o]||"default",F=async()=>{B.value=!0;try{const o=await $.get("/api/purchase-orders",{params:m.value});Y.value=o.data.data||o.data}catch(o){console.error("Failed to load purchase orders:",o)}finally{B.value=!1}},pe=async o=>{try{const e=await $.get(`/api/purchase-orders/${o.id}`);d.value=e.data,P.value=!0}catch(e){console.error("Failed to load PO details:",e)}},qe=()=>{v.value.items.push({product_id:null,quantity:1,unit_id:null,unit_cost:0,available_units:[],conversion_info:null})},me=async(o,e)=>{var l;if(!o.product_id){o.available_units=[],o.unit_id=null;return}try{const s=await $.get(`/api/products/${o.product_id}/units`,{params:{type:"purchase"}});o.available_units=s.data||[];const u=o.available_units.find(y=>y.is_default);o.unit_id=u?u.id:((l=o.available_units[0])==null?void 0:l.id)||null,o.unit_id&&await oe(o)}catch(s){console.error("Failed to load product units:",s);const u=w.value.find(y=>y.id===o.product_id);u&&u.unit&&(o.available_units=[{id:u.unit.id,name:u.unit.name,short_name:u.unit.short_name,conversion_factor:1,is_default:!0}],o.unit_id=u.unit.id)}},oe=async o=>{var e;if(!(!o.unit_id||!o.product_id))try{console.log("Unit changed:",{product_id:o.product_id,unit_id:o.unit_id});const l=await $.post(`/api/products/${o.product_id}/units/price`,{unit_id:o.unit_id,price_type:"cost"});console.log("Unit price response:",l.data),l.data.price?(o.unit_cost=l.data.price,console.log("Updated unit_cost to:",o.unit_cost)):console.warn("No price returned from API"),ue(o)}catch(l){console.error("Failed to get unit price:",l),console.error("Error details:",(e=l.response)==null?void 0:e.data)}},ue=o=>{if(!o.quantity||!o.unit_id||!o.available_units){o.conversion_info=null;return}const e=o.available_units.find(u=>u.id===o.unit_id);if(!e||e.conversion_factor===1){o.conversion_info=null;return}const l=o.quantity*e.conversion_factor,s=de(o.product_id);o.conversion_info=`${o.quantity} ${e.short_name} = ${l} ${s}`},de=o=>{var l;const e=w.value.find(s=>s.id===o);return((l=e==null?void 0:e.unit)==null?void 0:l.short_name)||"units"},Se=o=>{v.value.items.splice(o,1)},Oe=()=>v.value.items.reduce((o,e)=>o+e.quantity*e.unit_cost,0),Ne=()=>{v.value={supplier_id:null,store_id:null,order_date:new Date().toISOString().split("T")[0],expected_date:"",notes:"",items:[]},A.value=!0},Ae=async()=>{var o,e;if(!v.value.items||v.value.items.length===0){x("Please add at least one item to the purchase order");return}I.value=!0;try{const l={supplier_id:v.value.supplier_id,store_id:v.value.store_id,order_date:v.value.order_date,expected_delivery_date:v.value.expected_date||null,notes:v.value.notes,items:v.value.items};await $.post("/api/purchase-orders",l),A.value=!1,F(),x("Purchase order created successfully")}catch(l){console.error("Failed to create PO:",l);const s=((e=(o=l.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to create PO";x(s)}finally{I.value=!1}},De=o=>{c.value={id:o.id,po_number:o.po_number,supplier_id:o.supplier_id,store_id:o.store_id,order_date:o.order_date,expected_date:o.expected_delivery_date||"",notes:o.notes||"",items:o.items.map(e=>({product_id:e.product_id,quantity:e.quantity,unit_cost:e.unit_cost}))},P.value=!1,q.value=!0},Fe=()=>{c.value.items.push({product_id:null,quantity:1,unit_id:null,unit_cost:0,available_units:[],conversion_info:null})},Re=o=>{c.value.items.splice(o,1)},Ie=()=>c.value.items.reduce((o,e)=>o+e.quantity*e.unit_cost,0),Te=async()=>{var o,e;if(!c.value.items||c.value.items.length===0){x("Please add at least one item to the purchase order");return}I.value=!0;try{const l={supplier_id:c.value.supplier_id,store_id:c.value.store_id,order_date:c.value.order_date,expected_delivery_date:c.value.expected_date||null,notes:c.value.notes,items:c.value.items};await $.put(`/api/purchase-orders/${c.value.id}`,l),q.value=!1,F(),x("Purchase order updated successfully")}catch(l){console.error("Failed to update PO:",l);const s=((e=(o=l.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to update PO";x(s)}finally{I.value=!1}},Me=async o=>{var l,s;if(await h(`Are you sure you want to cancel purchase order ${o.po_number}?`))try{await $.post(`/api/purchase-orders/${o.id}/cancel`,{}),F(),P.value&&(P.value=!1),x("Purchase order cancelled successfully")}catch(u){console.error("Failed to cancel PO:",u);const y=((s=(l=u.response)==null?void 0:l.data)==null?void 0:s.message)||"Failed to cancel PO";x(y)}},Ee=o=>{var l,s;const e=window.open("","_blank");e.document.write(`
    <html>
      <head>
        <title>Purchase Order - ${o.po_number}</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 20px; }
          h1 { color: #333; }
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          th { background-color: #f2f2f2; }
          .header { margin-bottom: 20px; }
          .total { text-align: right; font-weight: bold; margin-top: 20px; }
          @media print {
            button { display: none; }
          }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>Purchase Order</h1>
          <p><strong>PO Number:</strong> ${o.po_number}</p>
          <p><strong>Date:</strong> ${o.order_date}</p>
          <p><strong>Supplier:</strong> ${((l=o.supplier)==null?void 0:l.name)||"N/A"}</p>
          <p><strong>Store:</strong> ${((s=o.store)==null?void 0:s.name)||"N/A"}</p>
          <p><strong>Expected Delivery:</strong> ${o.expected_delivery_date||"N/A"}</p>
          <p><strong>Status:</strong> ${o.status}</p>
        </div>

        <table>
          <thead>
            <tr>
              <th>Product</th>
              <th>Quantity</th>
              <th>Unit Cost</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            ${o.items.map(u=>{var y;return`
              <tr>
                <td>${((y=u.product)==null?void 0:y.name)||"N/A"}</td>
                <td>${u.quantity}</td>
                <td>₦${new Intl.NumberFormat("en-NG").format(u.unit_cost)}</td>
                <td>₦${new Intl.NumberFormat("en-NG").format(u.quantity*u.unit_cost)}</td>
              </tr>
            `}).join("")}
          </tbody>
        </table>

        <div class="total">
          <p>Subtotal: ₦${new Intl.NumberFormat("en-NG").format(o.subtotal)}</p>
          <p>Tax: ₦${new Intl.NumberFormat("en-NG").format(o.tax_amount||0)}</p>
          <p style="font-size: 1.2em;">Total: ₦${new Intl.NumberFormat("en-NG").format(o.total_amount)}</p>
        </div>

        ${o.notes?`<p><strong>Notes:</strong> ${o.notes}</p>`:""}

        <button onclick="window.print()" style="margin-top: 20px; padding: 10px 20px; background: #4CAF50; color: white; border: none; cursor: pointer;">Print</button>
      </body>
    </html>
  `),e.document.close()},ve=async o=>{var l,s;if(await h(`Approve purchase order ${o.po_number}?`))try{await $.post(`/api/purchase-orders/${o.id}/approve`,{}),F(),P.value&&(P.value=!1),x("Purchase order approved successfully")}catch(u){console.error("Failed to approve PO:",u);const y=((s=(l=u.response)==null?void 0:l.data)==null?void 0:s.message)||"Failed to approve PO";x(y)}},ce=o=>{d.value=o,D.value={received_date:new Date().toISOString().split("T")[0],notes:"",items:o.items.map(e=>{var l;return{purchase_order_item_id:e.id,product_name:((l=e.product)==null?void 0:l.name)||"Unknown Product",quantity_ordered:e.quantity,already_received:e.received_quantity||0,quantity_received:e.quantity-(e.received_quantity||0)}})},b.value=!0},Ge=async()=>{var o,e;Q.value=!0;try{const l={received_date:D.value.received_date,notes:D.value.notes,items:D.value.items.map(s=>({purchase_order_item_id:s.purchase_order_item_id,quantity_received:s.quantity_received}))};await $.post(`/api/purchase-orders/${d.value.id}/receive`,l),b.value=!1,F(),x("Goods received successfully")}catch(l){console.error("Failed to receive goods:",l);const s=((e=(o=l.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to receive goods";x(s)}finally{Q.value=!1}};return Ke(async()=>{const[o,e,l]=await Promise.all([$.get("/api/stores"),$.get("/api/suppliers"),$.get("/api/products",{params:{per_page:1e3}})]);S.value=o.data.data||o.data,E.value=e.data.data||e.data,w.value=l.data.data||l.data,F()}),(o,e)=>(f(),C("div",null,[t(O,null,{default:a(()=>[t(i,{cols:"12"},{default:a(()=>[...e[35]||(e[35]=[r("h1",{class:"text-h4 mb-4"},"Purchase Orders",-1)])]),_:1})]),_:1}),t(O,null,{default:a(()=>[t(i,{cols:"12",md:"4"},{default:a(()=>[t(R,{modelValue:m.value.search,"onUpdate:modelValue":e[0]||(e[0]=l=>m.value.search=l),label:"Search (PO #, Supplier)","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:F},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",md:"3"},{default:a(()=>[t(ne,{modelValue:m.value.status,"onUpdate:modelValue":[e[1]||(e[1]=l=>m.value.status=l),F],items:Ce,label:"Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",md:"2"},{default:a(()=>[t(re,{modelValue:m.value.store_id,"onUpdate:modelValue":[e[2]||(e[2]=l=>m.value.store_id=l),F],items:S.value,"item-title":"name","item-value":"id",label:"Store",variant:"outlined",density:"compact",clearable:"",onCreated:e[3]||(e[3]=l=>S.value.push(l))},null,8,["modelValue","items"])]),_:1}),t(i,{cols:"12",md:"3",class:"text-right"},{default:a(()=>[G(N).hasPermission("create_purchase_orders")?(f(),k(_,{key:0,color:"primary",onClick:Ne},{default:a(()=>[t(U,{left:""},{default:a(()=>[...e[36]||(e[36]=[n("mdi-plus",-1)])]),_:1}),e[37]||(e[37]=n(" New PO ",-1))]),_:1})):g("",!0)]),_:1})]),_:1}),t(z,null,{default:a(()=>[t(We,{headers:$e,items:Y.value,loading:B.value},{"item.po_number":a(({item:l})=>[r("a",{onClick:s=>pe(l),class:"text-primary cursor-pointer"},p(l.po_number),9,he)]),"item.supplier":a(({item:l})=>{var s;return[n(p((s=l.supplier)==null?void 0:s.name),1)]}),"item.total_amount":a(({item:l})=>[n(" ₦"+p(T(l.total_amount)),1)]),"item.status":a(({item:l})=>[t(we,{color:ie(l.status),size:"small"},{default:a(()=>[n(p(l.status),1)]),_:2},1032,["color"])]),"item.actions":a(({item:l})=>[t(_,{icon:"",size:"small",onClick:s=>pe(l),title:"View"},{default:a(()=>[t(U,null,{default:a(()=>[...e[38]||(e[38]=[n("mdi-eye",-1)])]),_:1})]),_:1},8,["onClick"]),l.status==="pending"&&G(N).hasPermission("approve_purchase_orders")?(f(),k(_,{key:0,icon:"",size:"small",onClick:s=>ve(l),title:"Approve",color:"success"},{default:a(()=>[t(U,null,{default:a(()=>[...e[39]||(e[39]=[n("mdi-check",-1)])]),_:1})]),_:1},8,["onClick"])):g("",!0),l.status==="approved"&&G(N).hasPermission("receive_goods")?(f(),k(_,{key:1,icon:"",size:"small",onClick:s=>ce(l),title:"Receive Goods",color:"info"},{default:a(()=>[t(U,null,{default:a(()=>[...e[40]||(e[40]=[n("mdi-package-down",-1)])]),_:1})]),_:1},8,["onClick"])):g("",!0)]),_:1},8,["items","loading"])]),_:1}),t(X,{modelValue:P.value,"onUpdate:modelValue":e[10]||(e[10]=l=>P.value=l),"max-width":"900px"},{default:a(()=>[d.value?(f(),k(z,{key:0},{default:a(()=>[t(K,{class:"bg-primary text-white"},{default:a(()=>[n(" Purchase Order - "+p(d.value.po_number)+" ",1),t(we,{color:ie(d.value.status),class:"ml-2"},{default:a(()=>[n(p(d.value.status),1)]),_:1},8,["color"])]),_:1}),t(W,{class:"mt-4"},{default:a(()=>[t(O,null,{default:a(()=>[t(i,{cols:"6"},{default:a(()=>[e[41]||(e[41]=r("strong",null,"Date:",-1)),n(" "+p(d.value.order_date),1)]),_:1}),t(i,{cols:"6"},{default:a(()=>{var l;return[e[42]||(e[42]=r("strong",null,"Supplier:",-1)),n(" "+p((l=d.value.supplier)==null?void 0:l.name),1)]}),_:1}),t(i,{cols:"6"},{default:a(()=>{var l;return[e[43]||(e[43]=r("strong",null,"Store:",-1)),n(" "+p((l=d.value.store)==null?void 0:l.name),1)]}),_:1}),t(i,{cols:"6"},{default:a(()=>[e[44]||(e[44]=r("strong",null,"Expected Date:",-1)),n(" "+p(d.value.expected_delivery_date||"N/A"),1)]),_:1})]),_:1}),t(j,{class:"my-4"}),e[49]||(e[49]=r("h3",{class:"mb-2"},"Items",-1)),t(xe,null,{default:a(()=>[e[45]||(e[45]=r("thead",null,[r("tr",null,[r("th",null,"Product"),r("th",null,"Quantity Ordered"),r("th",null,"Quantity Received"),r("th",null,"Unit Price"),r("th",null,"Subtotal")])],-1)),r("tbody",null,[(f(!0),C(Z,null,ee(d.value.items,l=>{var s,u,y,fe,_e,ye,Ve,be,ge;return f(),C("tr",{key:l.id},[r("td",null,p((s=l.product)==null?void 0:s.name),1),r("td",null,[n(p(l.quantity)+" "+p(((u=l.unit)==null?void 0:u.short_name)||((fe=(y=l.product)==null?void 0:y.unit)==null?void 0:fe.short_name)||"")+" ",1),l.base_quantity&&l.base_quantity!==l.quantity?(f(),C("span",Ye," ("+p(l.base_quantity)+" "+p((ye=(_e=l.product)==null?void 0:_e.unit)==null?void 0:ye.short_name)+") ",1)):g("",!0)]),r("td",null,p(l.received_quantity||0)+" "+p(((Ve=l.unit)==null?void 0:Ve.short_name)||((ge=(be=l.product)==null?void 0:be.unit)==null?void 0:ge.short_name)||""),1),r("td",null,"₦"+p(T(l.unit_cost)),1),r("td",null,"₦"+p(T(l.line_total)),1)])}),128))])]),_:1}),t(j,{class:"my-4"}),t(O,null,{default:a(()=>[t(i,{cols:"6",offset:"6"},{default:a(()=>[r("div",Ze,[e[46]||(e[46]=r("span",null,"Subtotal:",-1)),r("span",null,"₦"+p(T(d.value.subtotal||0)),1)]),r("div",el,[e[47]||(e[47]=r("span",null,"Tax:",-1)),r("span",null,"₦"+p(T(d.value.tax_amount||0)),1)]),t(j,{class:"my-2"}),r("div",ll,[e[48]||(e[48]=r("span",null,"Total:",-1)),r("span",tl,"₦"+p(T(d.value.total_amount||0)),1)])]),_:1})]),_:1})]),_:1}),t(H,null,{default:a(()=>[t(_,{color:"primary",variant:"outlined",onClick:e[4]||(e[4]=l=>Ee(d.value))},{default:a(()=>[t(U,{left:""},{default:a(()=>[...e[50]||(e[50]=[n("mdi-printer",-1)])]),_:1}),e[51]||(e[51]=n(" Print ",-1))]),_:1}),["draft","pending"].includes(d.value.status)&&G(N).hasPermission("edit_purchase_orders")?(f(),k(_,{key:0,color:"warning",onClick:e[5]||(e[5]=l=>De(d.value))},{default:a(()=>[t(U,{left:""},{default:a(()=>[...e[52]||(e[52]=[n("mdi-pencil",-1)])]),_:1}),e[53]||(e[53]=n(" Edit ",-1))]),_:1})):g("",!0),["draft","pending"].includes(d.value.status)&&G(N).hasPermission("approve_purchase_orders")?(f(),k(_,{key:1,color:"success",onClick:e[6]||(e[6]=l=>ve(d.value))},{default:a(()=>[t(U,{left:""},{default:a(()=>[...e[54]||(e[54]=[n("mdi-check",-1)])]),_:1}),e[55]||(e[55]=n(" Approve ",-1))]),_:1})):g("",!0),d.value.status==="approved"&&G(N).hasPermission("receive_purchase_orders")?(f(),k(_,{key:2,color:"info",onClick:e[7]||(e[7]=l=>ce(d.value))},{default:a(()=>[t(U,{left:""},{default:a(()=>[...e[56]||(e[56]=[n("mdi-package-down",-1)])]),_:1}),e[57]||(e[57]=n(" Receive Goods ",-1))]),_:1})):g("",!0),!["received","completed","cancelled"].includes(d.value.status)&&G(N).hasPermission("delete_purchase_orders")?(f(),k(_,{key:3,color:"error",onClick:e[8]||(e[8]=l=>Me(d.value))},{default:a(()=>[t(U,{left:""},{default:a(()=>[...e[58]||(e[58]=[n("mdi-cancel",-1)])]),_:1}),e[59]||(e[59]=n(" Cancel ",-1))]),_:1})):g("",!0),t(J),t(_,{onClick:e[9]||(e[9]=l=>P.value=!1)},{default:a(()=>[...e[60]||(e[60]=[n("Close",-1)])]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1},8,["modelValue"]),t(X,{modelValue:A.value,"onUpdate:modelValue":e[20]||(e[20]=l=>A.value=l),"max-width":"1000px",persistent:""},{default:a(()=>[t(z,null,{default:a(()=>[t(K,null,{default:a(()=>[...e[61]||(e[61]=[n("New Purchase Order",-1)])]),_:1}),t(W,null,{default:a(()=>[t(te,{ref:"poForm"},{default:a(()=>[t(O,null,{default:a(()=>[t(i,{cols:"12",md:"6"},{default:a(()=>[t(Ue,{modelValue:v.value.supplier_id,"onUpdate:modelValue":e[11]||(e[11]=l=>v.value.supplier_id=l),items:E.value,"item-title":"name","item-value":"id",label:"Supplier *",variant:"outlined",rules:[l=>!!l||"Required"],onCreated:e[12]||(e[12]=l=>E.value.push(l))},null,8,["modelValue","items","rules"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(re,{modelValue:v.value.store_id,"onUpdate:modelValue":e[13]||(e[13]=l=>v.value.store_id=l),items:S.value,"item-title":"name","item-value":"id",label:"Store *",variant:"outlined",rules:[l=>!!l||"Required"],onCreated:e[14]||(e[14]=l=>S.value.push(l))},null,8,["modelValue","items","rules"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(L,{modelValue:v.value.order_date,"onUpdate:modelValue":e[15]||(e[15]=l=>v.value.order_date=l),label:"Order Date *",variant:"outlined",rules:[l=>!!l||"Required"]},null,8,["modelValue","rules"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(L,{modelValue:v.value.expected_date,"onUpdate:modelValue":e[16]||(e[16]=l=>v.value.expected_date=l),label:"Expected Delivery Date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(i,{cols:"12"},{default:a(()=>[t(ae,{modelValue:v.value.notes,"onUpdate:modelValue":e[17]||(e[17]=l=>v.value.notes=l),label:"Notes",variant:"outlined",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1}),t(j,{class:"my-4"}),r("div",al,[e[64]||(e[64]=r("h3",null,"Items *",-1)),t(_,{size:"small",color:"primary",onClick:qe},{default:a(()=>[t(U,{left:""},{default:a(()=>[...e[62]||(e[62]=[n("mdi-plus",-1)])]),_:1}),e[63]||(e[63]=n(" Add Item ",-1))]),_:1})]),v.value.items.length===0?(f(),k(le,{key:0,type:"warning",variant:"tonal",class:"mb-4"},{default:a(()=>[...e[65]||(e[65]=[n(" Please add at least one item to the purchase order ",-1)])]),_:1})):g("",!0),(f(!0),C(Z,null,ee(v.value.items,(l,s)=>(f(),k(O,{key:s,class:"mb-2"},{default:a(()=>[t(i,{cols:"12",md:"4"},{default:a(()=>[t(Pe,{modelValue:l.product_id,"onUpdate:modelValue":[u=>l.product_id=u,u=>me(l,s)],items:w.value,"item-title":"name","item-value":"id",label:"Product *",variant:"outlined",density:"compact",control:"autocomplete",rules:[u=>!!u||"Required"],onCreated:e[18]||(e[18]=u=>w.value.push(u))},null,8,["modelValue","onUpdate:modelValue","items","rules"])]),_:2},1024),t(i,{cols:"12",md:"2"},{default:a(()=>[t(R,{modelValue:l.quantity,"onUpdate:modelValue":u=>l.quantity=u,modelModifiers:{number:!0},label:"Quantity *",type:"number",variant:"outlined",density:"compact",rules:[u=>u>0||"Must be > 0"],onInput:u=>ue(l)},null,8,["modelValue","onUpdate:modelValue","rules","onInput"])]),_:2},1024),t(i,{cols:"12",md:"2"},{default:a(()=>[t(ne,{modelValue:l.unit_id,"onUpdate:modelValue":[u=>l.unit_id=u,u=>oe(l)],items:l.available_units||[],"item-title":"name","item-value":"id",label:"Unit *",variant:"outlined",density:"compact",disabled:!l.product_id},{item:a(({props:u,item:y})=>[t(ke,se({ref_for:!0},u),{title:a(()=>[n(p(y.raw.name)+" ",1),y.raw.conversion_factor>1?(f(),C("span",ol," ("+p(y.raw.conversion_factor)+" "+p(de(l.product_id))+") ",1)):g("",!0)]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled"])]),_:2},1024),t(i,{cols:"12",md:"2"},{default:a(()=>[t(R,{modelValue:l.unit_cost,"onUpdate:modelValue":u=>l.unit_cost=u,modelModifiers:{number:!0},label:"Unit Cost *",type:"number",variant:"outlined",density:"compact",rules:[u=>u>=0||"Must be >= 0"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(i,{cols:"12",md:"1",class:"d-flex align-center"},{default:a(()=>[t(_,{icon:"",size:"small",color:"error",onClick:u=>Se(s)},{default:a(()=>[t(U,null,{default:a(()=>[...e[66]||(e[66]=[n("mdi-delete",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024),l.conversion_info?(f(),k(i,{key:0,cols:"12"},{default:a(()=>[t(le,{type:"info",density:"compact",variant:"tonal"},{default:a(()=>[n(p(l.conversion_info),1)]),_:2},1024)]),_:2},1024)):g("",!0)]),_:2},1024))),128)),v.value.items.length>0?(f(),C("div",ul,[r("h3",null,"Total: ₦"+p(T(Oe())),1)])):g("",!0)]),_:1},512)]),_:1}),t(H,null,{default:a(()=>[t(J),t(_,{onClick:e[19]||(e[19]=l=>A.value=!1)},{default:a(()=>[...e[67]||(e[67]=[n("Cancel",-1)])]),_:1}),t(_,{color:"primary",onClick:Ae,loading:I.value},{default:a(()=>[...e[68]||(e[68]=[n("Create PO",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(X,{modelValue:b.value,"onUpdate:modelValue":e[24]||(e[24]=l=>b.value=l),"max-width":"900px",persistent:""},{default:a(()=>[d.value?(f(),k(z,{key:0},{default:a(()=>[t(K,null,{default:a(()=>[n("Receive Goods - "+p(d.value.po_number),1)]),_:1}),t(W,null,{default:a(()=>[t(te,{ref:"receiveForm"},{default:a(()=>[t(O,null,{default:a(()=>[t(i,{cols:"12",md:"6"},{default:a(()=>[t(L,{modelValue:D.value.received_date,"onUpdate:modelValue":e[21]||(e[21]=l=>D.value.received_date=l),label:"Received Date *",variant:"outlined",rules:[l=>!!l||"Required"]},null,8,["modelValue","rules"])]),_:1}),t(i,{cols:"12"},{default:a(()=>[t(ae,{modelValue:D.value.notes,"onUpdate:modelValue":e[22]||(e[22]=l=>D.value.notes=l),label:"Notes",variant:"outlined",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1}),t(j,{class:"my-4"}),e[70]||(e[70]=r("h3",{class:"mb-3"},"Items to Receive",-1)),t(xe,null,{default:a(()=>[e[69]||(e[69]=r("thead",null,[r("tr",null,[r("th",null,"Product"),r("th",null,"Ordered"),r("th",null,"Already Received"),r("th",null,"Receive Now *")])],-1)),r("tbody",null,[(f(!0),C(Z,null,ee(D.value.items,(l,s)=>(f(),C("tr",{key:s},[r("td",null,p(l.product_name),1),r("td",null,p(l.quantity_ordered),1),r("td",null,p(l.already_received),1),r("td",null,[t(R,{modelValue:l.quantity_received,"onUpdate:modelValue":u=>l.quantity_received=u,modelModifiers:{number:!0},type:"number",variant:"outlined",density:"compact",min:0,max:l.quantity_ordered-l.already_received,"hide-details":""},null,8,["modelValue","onUpdate:modelValue","max"])])]))),128))])]),_:1})]),_:1},512)]),_:1}),t(H,null,{default:a(()=>[t(J),t(_,{onClick:e[23]||(e[23]=l=>b.value=!1)},{default:a(()=>[...e[71]||(e[71]=[n("Cancel",-1)])]),_:1}),t(_,{color:"primary",onClick:Ge,loading:Q.value},{default:a(()=>[...e[72]||(e[72]=[n("Receive Goods",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})):g("",!0)]),_:1},8,["modelValue"]),t(X,{modelValue:q.value,"onUpdate:modelValue":e[34]||(e[34]=l=>q.value=l),"max-width":"1000px",persistent:""},{default:a(()=>[t(z,null,{default:a(()=>[t(K,null,{default:a(()=>[n("Edit Purchase Order - "+p(c.value.po_number),1)]),_:1}),t(W,null,{default:a(()=>[t(te,{ref:"editForm"},{default:a(()=>[t(O,null,{default:a(()=>[t(i,{cols:"12",md:"6"},{default:a(()=>[t(Ue,{modelValue:c.value.supplier_id,"onUpdate:modelValue":e[25]||(e[25]=l=>c.value.supplier_id=l),items:E.value,"item-title":"name","item-value":"id",label:"Supplier *",variant:"outlined",rules:[l=>!!l||"Required"],onCreated:e[26]||(e[26]=l=>E.value.push(l))},null,8,["modelValue","items","rules"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(re,{modelValue:c.value.store_id,"onUpdate:modelValue":e[27]||(e[27]=l=>c.value.store_id=l),items:S.value,"item-title":"name","item-value":"id",label:"Store *",variant:"outlined",rules:[l=>!!l||"Required"],onCreated:e[28]||(e[28]=l=>S.value.push(l))},null,8,["modelValue","items","rules"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(L,{modelValue:c.value.order_date,"onUpdate:modelValue":e[29]||(e[29]=l=>c.value.order_date=l),label:"Order Date *",variant:"outlined",rules:[l=>!!l||"Required"]},null,8,["modelValue","rules"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(L,{modelValue:c.value.expected_date,"onUpdate:modelValue":e[30]||(e[30]=l=>c.value.expected_date=l),label:"Expected Delivery Date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(i,{cols:"12"},{default:a(()=>[t(ae,{modelValue:c.value.notes,"onUpdate:modelValue":e[31]||(e[31]=l=>c.value.notes=l),label:"Notes",variant:"outlined",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1}),t(j,{class:"my-4"}),r("div",dl,[e[75]||(e[75]=r("h3",null,"Items *",-1)),t(_,{size:"small",color:"primary",onClick:Fe},{default:a(()=>[t(U,{left:""},{default:a(()=>[...e[73]||(e[73]=[n("mdi-plus",-1)])]),_:1}),e[74]||(e[74]=n(" Add Item ",-1))]),_:1})]),c.value.items.length===0?(f(),k(le,{key:0,type:"warning",variant:"tonal",class:"mb-4"},{default:a(()=>[...e[76]||(e[76]=[n(" Please add at least one item to the purchase order ",-1)])]),_:1})):g("",!0),(f(!0),C(Z,null,ee(c.value.items,(l,s)=>(f(),k(O,{key:s,class:"mb-2"},{default:a(()=>[t(i,{cols:"12",md:"4"},{default:a(()=>[t(Pe,{modelValue:l.product_id,"onUpdate:modelValue":[u=>l.product_id=u,u=>me(l,s)],items:w.value,"item-title":"name","item-value":"id",label:"Product *",variant:"outlined",density:"compact",control:"autocomplete",rules:[u=>!!u||"Required"],onCreated:e[32]||(e[32]=u=>w.value.push(u))},null,8,["modelValue","onUpdate:modelValue","items","rules"])]),_:2},1024),t(i,{cols:"12",md:"2"},{default:a(()=>[t(R,{modelValue:l.quantity,"onUpdate:modelValue":u=>l.quantity=u,modelModifiers:{number:!0},label:"Quantity *",type:"number",variant:"outlined",density:"compact",rules:[u=>u>0||"Must be > 0"],onInput:u=>ue(l)},null,8,["modelValue","onUpdate:modelValue","rules","onInput"])]),_:2},1024),t(i,{cols:"12",md:"2"},{default:a(()=>[t(ne,{modelValue:l.unit_id,"onUpdate:modelValue":[u=>l.unit_id=u,u=>oe(l)],items:l.available_units||[],"item-title":"name","item-value":"id",label:"Unit *",variant:"outlined",density:"compact",disabled:!l.product_id},{item:a(({props:u,item:y})=>[t(ke,se({ref_for:!0},u),{title:a(()=>[n(p(y.raw.name)+" ",1),y.raw.conversion_factor>1?(f(),C("span",nl," ("+p(y.raw.conversion_factor)+" "+p(de(l.product_id))+") ",1)):g("",!0)]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","items","disabled"])]),_:2},1024),t(i,{cols:"12",md:"2"},{default:a(()=>[t(R,{modelValue:l.unit_cost,"onUpdate:modelValue":u=>l.unit_cost=u,modelModifiers:{number:!0},label:"Unit Cost *",type:"number",variant:"outlined",density:"compact",rules:[u=>u>=0||"Must be >= 0"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(i,{cols:"12",md:"1",class:"d-flex align-center"},{default:a(()=>[t(_,{icon:"",size:"small",color:"error",onClick:u=>Re(s)},{default:a(()=>[t(U,null,{default:a(()=>[...e[77]||(e[77]=[n("mdi-delete",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024),l.conversion_info?(f(),k(i,{key:0,cols:"12"},{default:a(()=>[t(le,{type:"info",density:"compact",variant:"tonal"},{default:a(()=>[n(p(l.conversion_info),1)]),_:2},1024)]),_:2},1024)):g("",!0)]),_:2},1024))),128)),c.value.items.length>0?(f(),C("div",rl,[r("h3",null,"Total: ₦"+p(T(Ie())),1)])):g("",!0)]),_:1},512)]),_:1}),t(H,null,{default:a(()=>[t(J),t(_,{onClick:e[33]||(e[33]=l=>q.value=!1)},{default:a(()=>[...e[78]||(e[78]=[n("Cancel",-1)])]),_:1}),t(_,{color:"primary",onClick:Te,loading:I.value},{default:a(()=>[...e[79]||(e[79]=[n("Update PO",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},yl=Xe(sl,[["__scopeId","data-v-067df662"]]);export{yl as default};
