import{b as j,ac as G,r as u,c as L,o as W,e as $,f as d,h as t,w as l,V as r,i as b,q as D,m as S,g as T,j as y,E as U,n as c,p as i,G as A,ad as H,P as J,t as m,s as B,W as K,v as O,k as Q,af as X,ae as Y,a9 as Z,T as h,aa as ee,a2 as V}from"./app-CJq9zEpr.js";import{u as ae}from"./useToast-DKMsU9PD.js";import{_ as te}from"./CategorySelect-CGcOVtdp.js";import"./AddNewSelect-Cy-bT142.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"font-weight-bold"},oe={key:0,class:"text-caption text-grey"},ce={__name:"CategoryList",setup(se){const C=j(),{success:_,handleError:P}=ae(),{confirm:E}=G(),k=u(!1),w=u(!1),n=u(!1),v=u(!1),x=u(""),p=u([]),F=[{title:"Category",key:"name"},{title:"Parent",key:"parent"},{title:"Status",key:"is_active"},{title:"Actions",key:"actions",sortable:!1}],o=u({name:"",code:"",parent_id:null,description:"",is_active:!0}),q=L(()=>p.value.filter(s=>!s.parent_id)),f=async()=>{k.value=!0;try{const s={search:x.value},e=await V.get("/api/categories",{params:s});p.value=e.data.data||e.data}catch(s){console.error("Failed to load categories:",s)}finally{k.value=!1}},R=()=>{v.value=!1,o.value={name:"",code:"",parent_id:null,description:"",is_active:!0},n.value=!0},z=s=>{v.value=!0,o.value={...s},n.value=!0},N=()=>{n.value=!1},I=async()=>{w.value=!0;try{v.value?(await V.put(`/api/categories/${o.value.id}`,o.value),_("Category updated successfully")):(await V.post("/api/categories",o.value),_("Category created successfully")),N(),f()}catch(s){P(s,"Failed to save category")}finally{w.value=!1}},M=async s=>{if(await E(`Are you sure you want to delete ${s.name}?`))try{await V.delete(`/api/categories/${s.id}`),_("Category deleted successfully"),f()}catch(a){P(a,"Failed to delete category")}};return W(()=>{f()}),(s,e)=>(d(),$("div",null,[t(D,null,{default:l(()=>[t(r,{cols:"12"},{default:l(()=>[...e[8]||(e[8]=[b("h1",{class:"text-h4 mb-4"},"Product Categories",-1)])]),_:1})]),_:1}),t(D,null,{default:l(()=>[t(r,{cols:"12",md:"8"},{default:l(()=>[t(S,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),label:"Search categories...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:f},null,8,["modelValue"])]),_:1}),t(r,{cols:"12",md:"4",class:"text-right"},{default:l(()=>[U(C).hasPermission("create_product_categories")?(d(),T(c,{key:0,color:"primary",onClick:R},{default:l(()=>[t(A,{left:""},{default:l(()=>[...e[9]||(e[9]=[i("mdi-plus",-1)])]),_:1}),e[10]||(e[10]=i(" Add Category ",-1))]),_:1})):y("",!0)]),_:1})]),_:1}),t(B,null,{default:l(()=>[t(H,{headers:F,items:p.value,loading:k.value},{"item.name":l(({item:a})=>[b("div",null,[b("div",le,m(a.name),1),a.description?(d(),$("div",oe,m(a.description),1)):y("",!0)])]),"item.parent":l(({item:a})=>{var g;return[i(m(((g=a.parent)==null?void 0:g.name)||"Root"),1)]}),"item.is_active":l(({item:a})=>[t(J,{color:a.is_active?"success":"error",size:"small"},{default:l(()=>[i(m(a.is_active?"Active":"Inactive"),1)]),_:2},1032,["color"])]),"item.actions":l(({item:a})=>[U(C).hasPermission("update_product_categories")?(d(),T(c,{key:0,icon:"",size:"small",onClick:g=>z(a),title:"Edit"},{default:l(()=>[t(A,null,{default:l(()=>[...e[11]||(e[11]=[i("mdi-pencil",-1)])]),_:1})]),_:1},8,["onClick"])):y("",!0),U(C).hasPermission("delete_product_categories")?(d(),T(c,{key:1,icon:"",size:"small",onClick:g=>M(a),title:"Delete",color:"error"},{default:l(()=>[t(A,null,{default:l(()=>[...e[12]||(e[12]=[i("mdi-delete",-1)])]),_:1})]),_:1},8,["onClick"])):y("",!0)]),_:1},8,["items","loading"])]),_:1}),t(ee,{modelValue:n.value,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value=a),"max-width":"600px",persistent:""},{default:l(()=>[t(B,null,{default:l(()=>[t(K,null,{default:l(()=>[i(m(v.value?"Edit Category":"New Category"),1)]),_:1}),t(O,null,{default:l(()=>[t(Q,{ref:"form"},{default:l(()=>[t(D,null,{default:l(()=>[t(r,{cols:"12",md:"6"},{default:l(()=>[t(S,{modelValue:o.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.name=a),label:"Category Name *",variant:"outlined",rules:[a=>!!a||"Required"]},null,8,["modelValue","rules"])]),_:1}),t(r,{cols:"12",md:"6"},{default:l(()=>[t(S,{modelValue:o.value.code,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.code=a),label:"Category Code *",variant:"outlined",rules:[a=>!!a||"Required"],hint:"Unique code for this category"},null,8,["modelValue","rules"])]),_:1}),t(r,{cols:"12"},{default:l(()=>[t(te,{modelValue:o.value.parent_id,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.parent_id=a),items:q.value,"item-title":"name","item-value":"id",label:"Parent Category",variant:"outlined",clearable:"",onCreated:e[4]||(e[4]=a=>p.value.push(a))},null,8,["modelValue","items"])]),_:1}),t(r,{cols:"12"},{default:l(()=>[t(X,{modelValue:o.value.description,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.description=a),label:"Description",variant:"outlined",rows:"2"},null,8,["modelValue"])]),_:1}),t(r,{cols:"12"},{default:l(()=>[t(Y,{modelValue:o.value.is_active,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.is_active=a),label:"Active",color:"primary"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),t(Z,null,{default:l(()=>[t(h),t(c,{onClick:N},{default:l(()=>[...e[13]||(e[13]=[i("Cancel",-1)])]),_:1}),t(c,{color:"primary",onClick:I,loading:w.value},{default:l(()=>[...e[14]||(e[14]=[i("Save",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{ce as default};
